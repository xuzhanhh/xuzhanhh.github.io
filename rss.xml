<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[é…±é¦™å‹çŒ«ç ‚ç›†]]></title><description><![CDATA[Personal blog by Dan Abramov. I explain with words and code.]]></description><link>https://overreacted.io</link><generator>RSS for Node</generator><lastBuildDate>Mon, 08 Apr 2019 03:39:15 GMT</lastBuildDate><item><title><![CDATA[Reactä¸­çš„concurrent mode(1)]]></title><description><![CDATA[rAFçš„è°ƒåº¦æ–¹å¼ 1. æ‰€æœ‰rAFå›è°ƒå§‹ç»ˆåœ¨ç›¸åŒæˆ–ä¸‹ä¸€ä¸ªå¸§ä¸­è¿è¡Œ Â  Â  Â  Â  åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ’é˜Ÿçš„ä»»ä½•rAFéƒ½å°†åœ¨åŒä¸€å¸§ä¸­æ‰§è¡Œã€‚ åœ¨rAFä¸­æ’é˜Ÿçš„ä»»ä½•rAFå°†åœ¨ä¸‹ä¸€å¸§ä¸­æ‰§è¡Œã€‚ 2. æ¯ä¸€ä¸ªä½ è§¦å‘çš„rAFéƒ½ä¼šè¿è¡Œ Â  Â  Â  Â  å°½ç®¡æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼ŒrAFâ€¦]]></description><link>https://overreacted.io/Reactä¸­çš„Scheduler/</link><guid isPermaLink="false">https://overreacted.io/Reactä¸­çš„Scheduler/</guid><pubDate>Sat, 06 Apr 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;rAFçš„è°ƒåº¦æ–¹å¼&lt;/h2&gt;
&lt;h3&gt;1. æ‰€æœ‰rAFå›è°ƒå§‹ç»ˆåœ¨ç›¸åŒæˆ–ä¸‹ä¸€ä¸ªå¸§ä¸­è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;Â Â Â Â åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ’é˜Ÿçš„ä»»ä½•rAFéƒ½å°†åœ¨åŒä¸€å¸§ä¸­æ‰§è¡Œã€‚ åœ¨rAFä¸­æ’é˜Ÿçš„ä»»ä½•rAFå°†åœ¨ä¸‹ä¸€å¸§ä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3&gt;2. æ¯ä¸€ä¸ªä½ è§¦å‘çš„rAFéƒ½ä¼šè¿è¡Œ&lt;/h3&gt;
&lt;p&gt;Â Â Â Â å°½ç®¡æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼ŒrAFä¹Ÿä¸ä¼šå—åˆ°é™åˆ¶ã€‚ä¾‹å¦‚é˜Ÿåˆ—ä¸­æœ‰äº”ä¸ªrAFå›è°ƒï¼Œæ¯ä¸ªéƒ½ä¼šå ç”¨100msæ—¶é—´ã€‚æµè§ˆå™¨ä¾ç„¶ä¸ä¼šåˆ†å‘ä»–ä»¬åˆ°æ¯ä¸€å¸§ä¸­ï¼Œè€Œæ˜¯åœ¨åŒä¸€å¸§ä¸­æ‰§è¡Œï¼Œå°½ç®¡å®ƒä¼šå ç”¨500msæ—¶é—´ã€‚è¿™ä¼šé€ æˆä¸€ä¸ªä¸¥é‡çš„é˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä¸¤ç§æƒ…å†µå°±ä¼šè§¦å‘è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;Â Â Â Â 1. åœ¨ä¸€ä¸ªrAFç»“å°¾è¯·æ±‚ä¸€ä¸ªæ–°çš„callback
Â Â Â Â 2. ä½ åœ¨ä¸€ä¸ªinputæ—¶é—´å¤„ç†å™¨ä¸­è°ƒç”¨rAFï¼Œè¿™æ ·å¯èƒ½åœ¨ä¸€å¸§ä¸­è°ƒç”¨å¤šæ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;strong&gt;ä½ å¯ä»¥è‡ªå·±åˆå¹¶rAF&lt;/strong&gt;ã€‚å› æ­¤ï¼šå¦‚æœåœ¨åŒä¸€å¸§å†…æœ‰å¤šä¸ªâ€œç›¸åŒâ€å›è°ƒè§¦å‘ï¼Œåˆ™å¿…é¡»ç®¡ç†è°ƒåº¦/åˆå¹¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒChromeç­‰æµè§ˆåŒºä¼šå°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœrAFæ­£åœ¨å ç”¨ä¸»çº¿ç¨‹ï¼Œæµè§ˆå™¨å°†å¼€å§‹é™åˆ¶è¾“å…¥äº‹ä»¶ï¼Œä»¥ä¾¿å¸Œæœ›äº‰ç”¨å°†è¢«æ¸…é™¤ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸€å¸§é‡Œæµè§ˆå™¨ä¼šåšä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;ä¸»çº¿ç¨‹ï¼š&lt;img src=&quot;/images/1*ad-k5hYKQnRQJF8tv8BIqg.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¤šçº¿ç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/1*atEwskfs0gtIryRrgnAPkw.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h2&gt;å¦‚ä½•å®šä¹‰requestIdleCallback&lt;/h2&gt;
&lt;p&gt;w3cå¯¹requestIdelCallbackçš„éè§„èŒƒå®šä¹‰å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;Â Â Â Â åœ¨è¾“å…¥å¤„ç†ï¼Œç»™å®šå¸§çš„æ¸²æŸ“å’Œåˆæˆå®Œæˆä¹‹åï¼Œç”¨æˆ·ä»£ç†çš„ä¸»çº¿ç¨‹ç»å¸¸å˜ä¸ºç©ºé—²ï¼Œç›´åˆ°ä¸‹ä¸€å¸§å¼€å§‹;å¦ä¸€ä¸ªå¾…å¤„ç†çš„ä»»åŠ¡æœ‰èµ„æ ¼è¿è¡Œ;æˆ–æ”¶åˆ°ç”¨æˆ·è¾“å…¥ã€‚æ­¤è§„èŒƒæä¾›äº†ä¸€ç§é€šè¿‡requestIdleCallback APIåœ¨æ­¤ç©ºé—²æ—¶é—´å†…è°ƒåº¦å›è°ƒæ‰§è¡Œçš„æ–¹æ³•ã€‚é€šè¿‡requestIdleCallback APIå‘å¸ƒçš„å›è°ƒæœ‰èµ„æ ¼åœ¨ç”¨æˆ·ä»£ç†å®šä¹‰çš„ç©ºé—²æ—¶æ®µå†…è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Â Â Â Â å½“æ‰§è¡Œç©ºé—²å›è°ƒæ—¶ï¼Œå°†ç»™å‡ºå¯¹åº”äºå½“å‰ç©ºé—²æ—¶æ®µç»“æŸçš„æˆªæ­¢æ—¶é—´ã€‚å…³äºä»€ä¹ˆæ„æˆç©ºé—²æ—¶æ®µçš„å†³å®šæ˜¯ç”¨æˆ·ä»£ç†å®šä¹‰çš„ï¼Œä½†æ˜¯æœŸæœ›å®ƒä»¬å‘ç”Ÿåœ¨æµè§ˆå™¨æœŸæœ›ç©ºé—²çš„é™æ­¢æ—¶æ®µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;Â Â Â Â ç©ºé—²æ—¶æ®µçš„ä¸€ä¸ªç¤ºä¾‹æ˜¯åœ¨ç»™å®šå¸§æäº¤åˆ°å±å¹•å’Œåœ¨æ´»åŠ¨åŠ¨ç”»æœŸé—´å¼€å§‹ä¸‹ä¸€å¸§å¤„ç†ä¹‹é—´çš„æ—¶é—´ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚è¿™äº›ç©ºé—²æ—¶æ®µå°†åœ¨æ´»åŠ¨åŠ¨ç”»å’Œå±å¹•æ›´æ–°æœŸé—´é¢‘ç¹å‘ç”Ÿï¼Œä½†é€šå¸¸ä¼šéå¸¸çŸ­ï¼ˆå³ï¼Œå¯¹äºå…·æœ‰60Hz vsyncå‘¨æœŸçš„è®¾å¤‡ï¼Œå°äº16msï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image01.png&quot; alt=&quot;Example of an inter-frame idle period.&quot;&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â ç©ºé—²æ—¶æ®µçš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯å½“ç”¨æˆ·ä»£ç†ç©ºé—²è€Œæ²¡æœ‰å‘ç”Ÿå±å¹•æ›´æ–°æ—¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»£ç†å¯èƒ½æ²¡æœ‰å³å°†åˆ°æ¥çš„ä»»åŠ¡ï¼Œå®ƒå¯ä»¥é™åˆ¶ç©ºé—²æ—¶æ®µçš„ç»“æŸã€‚&lt;/p&gt;
&lt;p&gt; Â Â Â Â ä¸ºäº†é¿å…åœ¨ä¸å¯é¢„æµ‹çš„ä»»åŠ¡ä¸­å¼•èµ·ç”¨æˆ·å¯å¯Ÿè§‰çš„å»¶è¿Ÿï¼Œä¾‹å¦‚ç”¨æˆ·è¾“å…¥çš„å¤„ç†ï¼Œè¿™äº›ç©ºé—²æ—¶æ®µçš„é•¿åº¦åº”è¯¥è¢«é™åˆ¶ä¸ºæœ€å¤§å€¼50msã€‚ ä¸€æ—¦ç©ºé—²æ—¶æ®µç»“æŸï¼Œç”¨æˆ·ä»£ç†å¯ä»¥è°ƒåº¦å¦ä¸€ä¸ªç©ºé—²æ—¶æ®µï¼Œå¦‚æœå®ƒä¿æŒç©ºé—²ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œä»¥ä½¿åå°å·¥ä½œèƒ½å¤Ÿåœ¨æ›´é•¿çš„ç©ºé—²æ—¶é—´æ®µå†…ç»§ç»­å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image00.png&quot; alt=&quot;Example of an idle period when there are no pending frame updates.&quot;&gt;&lt;/p&gt;
&lt;h2&gt;Reactä¸­çš„requestIdleCallback&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹çš„ä»£ç æ˜¯å®è´¨ä¸Šæ˜¯requestIdleCallbackçš„polyfillï¼Œé€šè¿‡è°ƒåº¦rAFï¼Œå­˜å‚¨å¸§å¼€å§‹çš„æ—¶é—´ï¼Œç„¶ååœ¨ç»˜åˆ¶(paint)åå®‰æ’ä¸€ä¸ªpostMessageè¯·æ±‚ã€‚
åœ¨postMessageå¤„ç†é€»è¾‘ä¸­ï¼ŒReactä¼šåœ¨æœ‰é™çš„æ—¶é—´ä¸­å°½å¯èƒ½çš„å¤šå·¥ä½œã€‚
é€šè¿‡å°†ç©ºé—²è°ƒç”¨(idle call)æ‹†åˆ†åˆ°å¤šæ¬¡event tickï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¸ƒå±€(layout), ç»˜åˆ¶(paint)å’Œå…¶ä»–æµè§ˆå™¨å·¥ä½œåœ¨æœ‰æ•ˆçš„æ—¶é—´ä¸­èƒ½æ­£å¸¸çš„å·¥ä½œï¼Œè€Œä¸”å¸§ç‡æ˜¯åŠ¨æ€è°ƒæ•´çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;åˆå§‹åŒ–å¤„ç†&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Reactä¼šå…ˆä»éœ€è¦çš„å…¨å±€å¼•ç”¨ä¸­æ•è·åˆ°æœ¬åœ°å¼•ç”¨ï¼Œä»¥é˜²åœ¨ä»£ç æ‰§è¡Œçš„åç»­è¿‡ç¨‹ä¸­å…¨å±€å¼•ç”¨å—åˆ°æ”¹åŠ¨å¯¼è‡´ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; localDate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; localSetTimeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; setTimeout &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; setTimeout &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; localClearTimeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; clearTimeout &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; clearTimeout &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; localRequestAnimationFrame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; requestAnimationFrame &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; requestAnimationFrame
    &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; localCancelAnimationFrame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; cancelAnimationFrame &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; cancelAnimationFrame &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; getCurrentTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“é¡µé¢ä¸åœ¨å‰å°æ—¶rAFä¸ä¼šè¿è¡Œã€‚å¦‚æœé¡µé¢åœ¨åå°åˆ™éœ€è¦è°ƒåº¦å·¥ä½œç»§ç»­è¿›è¡Œï¼Œå› ä¸ºé¡µé¢éœ€è¦ç»§ç»­åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤Reactä¼šç”¨setTimeoutç»§ç»­è°ƒåº¦ä½œä¸ºå¤‡ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ANIMATION_FRAME_TIMEOUT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; rAFID&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; rAFTimeoutID&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;requestAnimationFrameWithTimeout&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// è§¦å‘ä¸€ä¸ªrAFå’ŒsetTimeout&lt;/span&gt;
  rAFID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;localRequestAnimationFrame&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timestamp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// è§¦å‘äº†rAFåˆ™å–æ¶ˆsetTimeout&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;localClearTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rAFTimeoutID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timestamp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  rAFTimeoutID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;localSetTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// è§¦å‘äº†setTimeoutåˆ™å–æ¶ˆrAF&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;localCancelAnimationFrame&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rAFID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ANIMATION_FRAME_TIMEOUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Â Â Â Â åœ¨åˆå§‹åŒ–å®Œæˆåï¼ŒReactä¼šæ ¹æ®æ˜¯å¦æœ‰windowï¼ŒmessageChannelç­‰å¯¹è±¡åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒï¼Œæ‰§è¡Œä¸åŒçš„æµç¨‹ã€‚è¿™é‡Œåªçœ‹æ­£å¸¸çš„æµè§ˆå™¨ç¯å¢ƒã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; isMessageEventScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; timeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; isAnimationFrameScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; isFlushingHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; frameDeadline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Reactå‡è®¾ä»30fpså¼€å§‹å¹¶é€šè¿‡å¯å‘å¼çš„è·Ÿè¸ªè°ƒæ•´é€Ÿåº¦ã€‚å¦‚æœæœ‰æ›´é¢‘ç¹çš„åŠ¨ç”»å¸§åˆ™frameTimeæ›´å°‘&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; previousFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;33&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; activeFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;33&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function-variable function&quot;&gt;shouldYieldToHost&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; frameDeadline &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getCurrentTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Reactä½¿ç”¨postMessageæ‰‹æ®µå»å»¶è¿Ÿç©ºé—²å·¥ä½œçš„æ—¶é—´åœ¨é‡ç»˜(repaint)ä¹‹å&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MessageChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port2&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Â Â Â Â ä¸ºäº†é˜…è¯»æ›´æ¸…æ™°ï¼Œä¸‹é¢çš„ä»£ç é¡ºåºä¸Reactæºç ä¸­çš„ä¸å¤ªç›¸åŒã€‚&lt;/p&gt;
&lt;h3&gt;requestHostCallback&amp;#x26;&amp;#x26;cancelHostCallback&lt;/h3&gt;
&lt;p&gt;Â Â Â Â rICçš„polyfillä¸­æœ€å¤–å±‚çš„ä»£ç æ˜¯&lt;strong&gt;requestHostCallback&lt;/strong&gt;å’Œ&lt;strong&gt;cancelHostCallback&lt;/strong&gt;ã€‚requestHostCallbackçš„å…¥å‚å’ŒrICçš„ç›¸ä¼¼ï¼Œä¼ å…¥éœ€è¦è°ƒç”¨çš„å‡½æ•°å’Œå¿…é¡»æ‰§è¡Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  &lt;span class=&quot;token function-variable function&quot;&gt;requestHostCallback&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; absoluteTimeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    timeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; absoluteTimeout&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isFlushingHostCallback &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; absoluteTimeout &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœä¸Šä¸€ä¸ªcallbackæ­£åœ¨æ‰§è¡Œä¸­æˆ–è€…absoluteTimeout&amp;lt;0ï¼Œä¸ç­‰å¾…ä¸‹ä¸€å¸§ï¼Œåœ¨ä¸€ä¸ªæ–°postMessageä¸­å°½å¿«æ‰§è¡Œ&lt;/span&gt;
      port&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;undefined&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isAnimationFrameScheduled&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœå½“å‰æ²¡æœ‰è°ƒåº¦çš„rAF,è°ƒåº¦ä¸€ä¸ª&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// TODO: å¦‚æœå› ä¸ºæµè§ˆå™¨èŠ‚æµå¯¼è‡´rAFæ²¡æœ‰è¢«è§¦å‘ï¼ŒReactè€ƒè™‘ä½¿ç”¨setTimeoutè§¦å‘rICç¡®ä¿æ‰§è¡Œå·¥ä½œ&lt;/span&gt;
      isAnimationFrameScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;requestAnimationFrameWithTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;animationTick&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function-variable function&quot;&gt;cancelHostCallback&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// æ¸…ç©ºæ•°æ®&lt;/span&gt;
    scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    isMessageEventScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    timeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;animationTick&lt;/h3&gt;
&lt;p&gt;Â Â Â Â animationTickæ˜¯Reactä¼ å…¥rAFä¸­çš„å›è°ƒå‡½æ•°&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;animationTick&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rafTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token comment&quot;&gt;//åœ¨å¸§çš„å¼€å¤´å®‰æ’ä¸‹ä¸€ä¸ªåŠ¨ç”»å›è°ƒã€‚ å¦‚æœè°ƒåº¦ç¨‹åºé˜Ÿåˆ—åœ¨å¸§çš„æœ«å°¾ä¸ä¸ºç©ºï¼Œå®ƒå°†ç»§ç»­åœ¨è¯¥å›è°ƒå†…åˆ·æ–°ã€‚ å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™å®ƒå°†ç«‹å³é€€å‡ºã€‚&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šç«‹åˆ»é€€å‡ºã€‚åœ¨å¸§çš„å¼€å¤´è°ƒç”¨rAFå›è°ƒå¯ç¡®ä¿åœ¨æœ€æ—©çš„å¸§å†…è§¦å‘&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœåœ¨å¸§ç»“æŸæ—¶å‘å¸ƒå›è°ƒå°±æœ‰å¯èƒ½è¢«æµè§ˆå™¨è·³è¿‡å¸§ä¸”ä¸è§¦å‘å›è°ƒç›´åˆ°ä¸‹ä¸€å¸§æ‰§è¡Œ&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;requestAnimationFrameWithTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;animationTick&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å½“å‰æ²¡æœ‰ä¸œè¥¿è¦å¤„ç†äº†ï¼Œç»“æŸrAFå›è°ƒ&lt;/span&gt;
      isAnimationFrameScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// ä¸‹ä¸€å¸§å¯ç”¨çš„æ—¶é—´ç­‰äºå½“å‰æ—¶é—´-ä¸Šä¸€å¸§ç»“æŸæ—¶é—´+å¸§å¯ç”¨æ—¶é—´&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; nextFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rafTime &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; frameDeadline &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; activeFrameTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      nextFrameTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; activeFrameTime &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      previousFrameTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; activeFrameTime
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextFrameTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//Reactä¸æ”¯æŒå¸§ç‡é«˜äº120hzçš„æµè§ˆè®¾å¤‡&lt;/span&gt;
        nextFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœä¸€å¸§é•¿ï¼Œé‚£ä¹ˆä¸‹ä¸€å¸§å¯èƒ½å¾ˆçŸ­ã€‚ &lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœä¸¤ä¸ªå¸§è¿ç»­çŸ­ï¼Œé‚£ä¹ˆè¿™è¡¨æ˜æˆ‘ä»¬å®é™…ä¸Šå…·æœ‰æ¯”æˆ‘ä»¬å½“å‰ä¼˜åŒ–çš„å¸§é€Ÿç‡æ›´é«˜çš„å¸§é€Ÿç‡ã€‚ &lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// æˆ‘ä»¬ç›¸åº”åœ°åŠ¨æ€è°ƒæ•´å¯å‘å¼ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨120hzæ˜¾ç¤ºå™¨æˆ–90hz VRæ˜¾ç¤ºå™¨ä¸Šè¿è¡Œã€‚ å–ä¸¤ä¸ªä¸­çš„æœ€å¤§å€¼ï¼Œä»¥é˜²å…¶ä¸­ä¸€ä¸ªç”±äºé”™è¿‡å¸§æˆªæ­¢æ—¥æœŸè€Œå¼‚å¸¸ã€‚&lt;/span&gt;
      activeFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        nextFrameTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; previousFrameTime &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; previousFrameTime &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nextFrameTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      previousFrameTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextFrameTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å½“å‰å¸§ç»“æŸæ—¶é—´ç­‰äºå½“å‰æ—¶é—´+å¸§å¯ç”¨æ—¶é—´&lt;/span&gt;
    frameDeadline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rafTime &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; activeFrameTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœå½“å‰æ²¡æœ‰postMessageè§¦å‘&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isMessageEventScheduled&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
      isMessageEventScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      port&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;undefined&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;onmessage(rICçš„callback)&lt;/h3&gt;
&lt;p&gt;Â Â Â Â ä¸»è¦æµç¨‹ä¸ºæ£€æŸ¥å½“å‰å¸§è¿˜æ˜¯å¦å¤Ÿæ—¶é—´è§¦å‘callbackï¼Œå¤Ÿå°±è°ƒç”¨ï¼Œä¸å¤Ÿå°±è°ƒç”¨rAFç­‰å¾…ä¸‹ä¸€å¸§&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onmessage&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    isMessageEventScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; prevScheduledCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; scheduledHostCallback&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; prevTimeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; timeoutTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    timeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; currentTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getCurrentTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; didTimeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;frameDeadline &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; currentTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ç©ºé—²é˜¶æ®µæ²¡æœ‰æ—¶é—´äº†ï¼Œæ£€æŸ¥callbackæ˜¯å¦æœ‰è¶…æ—¶æ—¶é—´å’Œåˆ°æ—¶é—´äº†æ²¡&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prevTimeoutTime &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; prevTimeoutTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; currentTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// åˆ°è¶…æ—¶æ—¶é—´äº†ï¼Œå³æ—¶å½“å‰å¸§æ²¡æ—¶é—´äº†ä¹Ÿè¦è§¦å‘&lt;/span&gt;
        didTimeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// è¿˜æ²¡åˆ°è¶…æ—¶æ—¶é—´&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isAnimationFrameScheduled&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// è§¦å‘ä¸€ä¸ªrAFé‡è¯•&lt;/span&gt;
          isAnimationFrameScheduled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;requestAnimationFrameWithTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;animationTick&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// ä¸è§¦å‘å›è°ƒï¼ŒæŠŠæ•°æ®æ”¾å›å»å¹¶ç»“æŸ&lt;/span&gt;
        scheduledHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevScheduledCallback&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        timeoutTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevTimeoutTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¤Ÿæ—¶é—´ï¼Œè§¦å‘callbackï¼Œæ ‡è®°æ­£åœ¨è§¦å‘callback&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prevScheduledCallback &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      isFlushingHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;prevScheduledCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;didTimeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        isFlushingHostCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;ç»“å°¾è¯­&lt;/h2&gt;
&lt;p&gt;Â Â Â Â æœ¬æ–‡åˆ°è¿™é‡Œå°±å…ˆç»“æŸäº†ï¼Œåœ¨è¿™ç¯‡blogä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ rAFçš„è°ƒåº¦æ–¹å¼ã€ä¸€å¸§é‡Œæµè§ˆå™¨ä¼šåšä»€ä¹ˆã€å¦‚ä½•å®šä¹‰rICä»¥åŠReactæ˜¯æ€ä¹ˆå®ç°rICçš„ï¼Œä¸»è¦æ˜¯é€šè¿‡rAF+postmessageå®ç°çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æ¥è§¦åˆ°Reactçš„å¹¶è¡Œæ¨¡å¼æ˜¯æ€ä¹ˆè°ƒç”¨rICçš„ï¼Œè¿™ä¸ªè¯·æœŸå¾…æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡blogã€‚&lt;/p&gt;
&lt;h2&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/@paul_irish/requestanimationframe-scheduling-for-nerds-9c57f7438ef4&quot;&gt;https://medium.com/@paul_irish/requestanimationframe-scheduling-for-nerds-9c57f7438ef4&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://w3c.github.io/requestidlecallback/#idle-periods&quot;&gt;https://w3c.github.io/requestidlecallback/#idle-periods&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[why hooks(2) â€” useEffectæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„]]></title><description><![CDATA[TODOï¼š æ·»åŠ å®é™…è¿è¡Œæ—¶çš„ç»“æ„ç­‰ å‰è¨€ â€‹		åœ¨ ä¸Šä¸€ç¯‡æ–‡ç«  ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº†useStateçš„å®ç°é€»è¾‘ï¼Œå¾—å‡ºæ˜¯å¦‚æœä¸è€ƒè™‘é¢å¤–çš„ä¼˜åŒ–é€»è¾‘ï¼ŒuseStateä¸fiberèŠ‚ç‚¹å”¯ä¸€çš„è”ç³»å°±æ˜¯hooksé˜Ÿåˆ—æ˜¯æŒ‚åœ¨fiberä¸Šçš„memoizedStateï¼Œå½“Reactâ€¦]]></description><link>https://overreacted.io/why hooks(2)/</link><guid isPermaLink="false">https://overreacted.io/why hooks(2)/</guid><pubDate>Fri, 22 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;TODOï¼š æ·»åŠ å®é™…è¿è¡Œæ—¶çš„ç»“æ„ç­‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;â€‹		åœ¨&lt;a href=&quot;https://xuzhanhh.com/why%20hooks/&quot;&gt;ä¸Šä¸€ç¯‡æ–‡ç« &lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº†useStateçš„å®ç°é€»è¾‘ï¼Œå¾—å‡ºæ˜¯å¦‚æœä¸è€ƒè™‘é¢å¤–çš„ä¼˜åŒ–é€»è¾‘ï¼ŒuseStateä¸fiberèŠ‚ç‚¹å”¯ä¸€çš„è”ç³»å°±æ˜¯hooksé˜Ÿåˆ—æ˜¯æŒ‚åœ¨fiberä¸Šçš„memoizedStateï¼Œå½“Reactæ‰§è¡Œåˆ°å½“å‰å‡½æ•°å¼ç»„ä»¶æ—¶ä¼šå°†å…¶æŒ‰åºå–å‡ºå¹¶æ›´æ–°ã€‚é‚£ä¹ˆè¿™ä¸€æ¬¡æˆ‘ä»¬æ¥åˆ°äº†useEffectï¼Œè¿™æ¬¡çš„hookæ˜¯ä¸react-reconcileræœ‰å¾ˆå¼ºçš„è”ç³»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªhooksæ‰“å¼€react-reconcilerçš„å¤§é—¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡æˆ‘ä»¬è¦è§‚å¯Ÿçš„ç»„ä»¶æ˜¯ğŸ‘‡ä»‹ä¸ªï¼Œæµç¨‹æ˜¯å½“ç‚¹å‡»äº‹ä»¶è§¦å‘å(Reactè§¦å‘ç»„ä»¶æ›´æ–°)ï¼Œæ§åˆ¶å°logä¹‹å‰Reactåˆ°åº•å¹²äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;App2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setData&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;trigger effect&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;mountEffect &amp;#x26; mountLayoutEffect&lt;/h2&gt;
&lt;p&gt;åŒæ ·åœ°ï¼Œæ ¹æ®è§¦å‘æ—¶é—´ä¸åŒuseEffectä¹Ÿåˆ†ä¸ºä¸¤ä¸ªfunc-mountEffectå’ŒupdateEffect&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//å‰¯ä½œç”¨func&lt;/span&gt;
  deps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mixed&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//è®°å¿†åŒ– ç”¨äºä»€ä¹ˆæ—¶å€™è§¦å‘&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountEffectImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    UpdateEffect &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; PassiveEffect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// fiberEffectTag&lt;/span&gt;
    UnmountPassive &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; MountPassive&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// hookEffectTag&lt;/span&gt;
    create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    deps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountLayoutEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  deps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mixed&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountEffectImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    UpdateEffect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//è¿™é‡Œä¸åŒå“¦ ä¸ä¼ passiveEffect&lt;/span&gt;
    UnmountMutation &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; MountLayout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    deps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹		é€šè¿‡ä»£ç å¯ä»¥çœ‹åˆ°mountEffectä¸mountLayoutEffectå”¯ä¸€çš„å·®åˆ«å°±æ˜¯ä¼ å…¥çš„fiberEffectTagå’ŒhookEffectTagä¸åŒï¼Œå½“ç„¶ï¼Œè¿™ä¸¤ä¸ªhookå…·ä½“çš„å·®åˆ«å¯ä»¥çœ‹&lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#uselayouteffect&quot;&gt;ä¼ é€é—¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	è¿™è¾¹ç®€å•ä»‹ç»ä¸‹&lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt;è§¦å‘çš„æ—¶æœºæ˜¯React commitå®Œæ¯•åå¼‚æ­¥æ‰§è¡Œï¼Œ&lt;code class=&quot;language-text&quot;&gt;useLayoutEffect&lt;/code&gt;æ˜¯React commitå®Œæ¯•ååŒæ­¥æ‰§è¡Œï¼Œå¦‚æœåœ¨useLayoutEffectä»£ç å¤ªé‡çš„è¯å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œè€ŒuseEffectåˆ™ä¸ä¼šé˜»å¡ï¼Œå› ä¸ºä»–ä¼šåœ¨æµè§ˆå™¨idleæ—¶é—´æ‰§è¡Œã€‚è¿™ç‚¹æˆ‘ä»¬ä¼šåœ¨åé¢çš„ä»£ç ä½“ç°ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	æˆ‘ä»¬å…ˆæŠ›å¼€useLayoutEffectåªçœ‹useEffectçš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountEffectImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fiberEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; hookEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountWorkInProgressHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; nextDeps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; deps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; undefined &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// åœ¨renderWithHooksä¸­ currentlyRenderingFiber.effectTag|= sideEffectTag ä»˜ç»™å½“å‰fiberèŠ‚ç‚¹&lt;/span&gt;
  sideEffectTag &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; fiberEffectTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   
  &lt;span class=&quot;token comment&quot;&gt;// åˆ›å»ºeffect&lt;/span&gt;
  hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pushEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hookEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextDeps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; FunctionComponentUpdateQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  lastEffect&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Effect &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pushEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; destroy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Effect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    tag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    destroy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    deps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ä¼¼æ‹Ÿ è‡ªåœ†&lt;/span&gt;
    next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;componentUpdateQueue &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    componentUpdateQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createFunctionComponentUpdateQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//è¿™ä¸ªç»“æ„å¾ˆç®€å•çš„ï¼Œçœ‹ä¸Šé¢çš„type&lt;/span&gt;
    componentUpdateQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœåªæœ‰ä»–ä¸€ä¸ª è‡ªåœ†&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; lastEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; componentUpdateQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastEffect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//è¿™é‡Œçš„é€»è¾‘å’ŒuseStateçš„ç›¸åŒå“¦&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastEffect &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      componentUpdateQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; firstEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lastEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      lastEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      effect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; firstEffect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      componentUpdateQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//åœ¨memoizedStateä¸­ä»…ä½œè®°å½•æ•°æ®ç”¨&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; effect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;updateEffect&lt;/h2&gt;
&lt;p&gt;â€‹	updateEffectçš„å¤§ä½“é€»è¾‘ä¸mountEffectç›¸åŒï¼Œä¸»è¦æ˜¯æ·»åŠ äº†pushEffectæ—¶ä»prevEffectå–å‡ºäº†destroyå‡½æ•°å¹¶ä¼ å…¥åˆ°pushEffectä¸­ï¼Œä¸”è¿›è¡Œä¾èµ–æ£€æŸ¥ï¼Œå¦‚æœç›¸åŒåˆ™åœ¨hookEffecté€‰æ‹©NoHookEffectï¼Œä¸æ›´æ–°memoizedStateå’Œä¸æ›´æ–°sideEffectTagä¸‰ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// è¿™ä¸ªfuncå’ŒmountEffectæ²¡ä»€ä¹ˆå·®åˆ«&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  deps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mixed&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateEffectImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    UpdateEffect &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; PassiveEffect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    UnmountPassive &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; MountPassive&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    deps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateEffectImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fiberEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; hookEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateWorkInProgressHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; nextDeps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; deps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; undefined &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; destroy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// å¦‚æœå½“å‰hookæœ‰æ•°æ®ï¼Œå³æ›´æ–°çŠ¶æ€&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentHook &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prevEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; currentHook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;// ä»ä¸Šä¸€æ¬¡è°ƒç”¨å®ŒsideEffectåçš„è¿”å›å€¼å–å‡ºdestroy&lt;/span&gt;
    destroy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destroy&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextDeps &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prevDeps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;deps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;areHookInputsEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextDeps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prevDeps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœä¾èµ–ä¸ä¸ºç©ºä¸”ä¸¤æ¬¡ä¾èµ–æ ¡éªŒç›¸åŒï¼Œåˆ™æ‰§è¡Œä¸Šé¢æ‰€è¯´çš„ä¸‰ç‚¹&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;pushEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;NoHookEffect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; destroy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextDeps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  sideEffectTag &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; fiberEffectTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pushEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hookEffectTag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; create&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; destroy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextDeps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‡³æ­¤ï¼ŒuseEffectåœ¨ReactFiberHooks.jsé‡Œçš„é€»è¾‘å·²ç»æ²¡æœ‰äº†ï¼Œå‰©ä¸‹æˆ‘ä»¬å°†è·‘å…¥react-reconcilerä¸­ã€‚è§‚å¯ŸuseEffectå‰©ä¸‹çš„é€»è¾‘æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚&lt;/p&gt;
&lt;h2&gt;renderé˜¶æ®µ&lt;/h2&gt;
&lt;p&gt;classç»„ä»¶çš„å…·ä½“æµç¨‹å¯ä»¥çœ‹æˆ‘è¿™ç¯‡&lt;a href=&quot;https://xuzhanhh.com/Inside%20Fiber/&quot;&gt;blog&lt;/a&gt;ï¼Œä¸‹é¢å¼€å§‹åˆ†æfunctionalç»„ä»¶ï¼Œæˆ‘ä¼šå°†è®¾è®¡ä¸€ä¸ªåˆ†ç•Œç‚¹åœ¨updateFunctionComponentï¼Œè¿™æ ·æˆ‘è®¤ä¸ºæµç¨‹çœ‹èµ·æ¥ä¼šæ›´åŠ æ¸…æ™°&lt;/p&gt;
&lt;h3&gt;åœ¨updateFunctionComponentä¹‹å‰&lt;/h3&gt;
&lt;h4&gt;renderRoot &amp;#x26; workloop&lt;/h4&gt;
&lt;p&gt;reconcileé€šå¸¸ä»&lt;code class=&quot;language-text&quot;&gt;HostRoot&lt;/code&gt;fiberç»“ç‚¹ï¼Œå¹¶é€šè¿‡&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L1132&quot;&gt;renderRoot&lt;/a&gt;æ–¹æ³•å¼€å§‹ã€‚ä½†æ˜¯ï¼ŒReactä¼šå¿«é€Ÿè·³è¿‡å·²ç»å¤„ç†è¿‡çš„fiberèŠ‚ç‚¹çŸ¥é“ä»–æ‰¾åˆ°ä¸€ä¸ªæœªå®Œæˆå·¥ä½œçš„ç»“ç‚¹ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œå¦‚æœä½ åœ¨ç»„ä»¶æ ‘çš„æ·±å±‚è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt;ï¼ŒReactä»ç„¶ä¼šä»RootèŠ‚ç‚¹å¼€å§‹reconcileä¸è¿‡ä¼šå¿«é€Ÿè·³è¿‡èŠ‚ç‚¹ç›´åˆ°é‡åˆ°è°ƒç”¨setStateçš„ç»„ä»¶ã€‚åœ¨renderRootä¸­ï¼Œæ‰€æœ‰çš„fiberèŠ‚ç‚¹éƒ½ä¼šåœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/f765f022534958bcf49120bf23bc1aa665e8f651/packages/react-reconciler/src/ReactFiberScheduler.js#L1136&quot;&gt;workloop&lt;/a&gt;ä¸­è¢«å¤„ç†ã€‚åœ¨æœ¬ç¯‡blogä¸­ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨åŒæ­¥æ¨¡å¼ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;workLoop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isYieldy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isYieldy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Flush work without yielding&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;performUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextUnitOfWork&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;nextUnitOfWork&lt;/code&gt;ä¼šä¿ç•™å¯¹&lt;code class=&quot;language-text&quot;&gt;workInProgress&lt;/code&gt;treeä¸­éœ€è¦å¤„ç†çš„fiberèŠ‚ç‚¹çš„å¼•ç”¨ã€‚å½“Reactéå†fiber treeæ—¶ï¼Œä¼šç”¨è¿™ä¸ªå˜é‡å»çŸ¥æ™“è¿™é‡Œæ˜¯å¦æœ‰å…¶ä»–æœªå®Œæˆå·¥ä½œçš„fiberç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¼šæœ‰å››ä¸ªä¸»è¦å‡½æ•°ç”¨äºéå†fiberæ ‘åŠå‘èµ·ã€å®Œæˆå·¥ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L1056&quot;&gt;performUnitOfWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js#L1489&quot;&gt;beginWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L879&quot;&gt;completeUnitOfWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberCompleteWork.js#L532&quot;&gt;completeWork&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªç®€åŒ–äº†çš„gifæ¼”ç¤ºä»–ä»¬æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ªfiberèŠ‚ç‚¹ä½œä¸ºå…¥å‚ã€‚å½“Reactéå†fiberæ ‘æ—¶å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å½“å‰fiberèŠ‚ç‚¹çš„å˜åŠ¨ï¼Œåœ¨å¤„ç†çˆ¶äº²èŠ‚ç‚¹å‰ä¼šå…ˆä¼šå®Œæˆå­©å­èŠ‚ç‚¹ã€‚è¿™ä¸ªå›¾åŠ¨çš„å¾ˆå¿«ï¼Œå»ºè®®ä»”ç»†ä¸€æ­¥æ­¥çœ‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŒä¸€åˆ—æ˜¯å…„å¼ŸèŠ‚ç‚¹ï¼Œå‘å³çš„æ˜¯å­©å­èŠ‚ç‚¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/images/1*A3-yF-3Xf47nPamFpRm64w.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h4&gt;performUnitOfWork&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;performUnitOfWork&lt;/strong&gt;æ¥æ”¶ä¸€ä¸ªä»&lt;strong&gt;workInProgress tree&lt;/strong&gt;ä¸­çš„fiberèŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨&lt;strong&gt;beginWork&lt;/strong&gt;ï¼ŒbeginWorkæ˜¯è§¦å‘fiberèŠ‚ç‚¹æ›´æ–°çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;performUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;beginWork&lt;/h4&gt;
&lt;p&gt;åœ¨beginWorkä¸­ï¼Œä¸»è¦é€»è¾‘åˆ†ä¸ºåˆ¤æ–­è¯¥fiberçš„propså’Œcontextæœ‰å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–åˆ™æ ‡è®°didReceiveUpdateä¸ºtrueï¼Œä¸”åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰æ›´æ–°åˆ™returnã€‚æ²¡æœ‰returnåˆ™è¿›å…¥æ›´æ–°ç»„ä»¶é˜¶æ®µã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// è¿™é‡Œåˆ†æå‡½æ•°å¼ç»„ä»¶çš„beginWork, current-&gt;å½“å‰æ¸²æŸ“ä½¿ç”¨çš„fiberï¼ŒworkInProgress-&gt;è¿™æ¬¡æ›´æ–°ç”¨çš„fiber&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; updateExpirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// è¿˜å‰©å¤šå°‘æ—¶é—´&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; oldProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pendingProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;oldProps &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; newProps &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hasLegacyContextChanged&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;//å¦‚æœpropsæˆ–è€…contextå˜åŒ–ï¼Œåˆ™æ ‡è®°è¯¥fiberèŠ‚ç‚¹åœ¨ä¹‹å‰å·²ç»æ›´æ–°è¿‡&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;//åœ¨memoçš„ä¸”memorizeç›¸åŒçš„æƒ…å†µä¸‹ä¸è®¾ç½®&lt;/span&gt;
      didReceiveUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updateExpirationTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      didReceiveUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// è¿™ä¸ªfiberèŠ‚ç‚¹æ²¡æ´»å¹²ï¼Œæ‰€ä»¥ç›´æ¥è·³å‡ºå³å¯ï¼Œä½†æ˜¯åœ¨è·³å‡ºå‰è¿˜æœ‰ä¸€äº›ä¼˜åŒ–é€»è¾‘è¦å¤„ç†ï¼Œe.g.å¾€æ ˆä¸Šæ”¾å¿…é¡»çš„æ•°æ®&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ...è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸å…³å¿ƒ&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bailoutOnAlreadyFinishedWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//å¦‚æœä¸Šä¸€ä¸ªçŠ¶æ€æ²¡æœ‰fiberèŠ‚ç‚¹&lt;/span&gt;
    didReceiveUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//æ¸…ç©ºå‘¼æ°”æ—¶é—´&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NoWork&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; FunctionComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; unresolvedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pendingProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; resolvedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elementType &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; Component
          &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; unresolvedProps
          &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resolveDefaultProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; unresolvedProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateFunctionComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        resolvedProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;updateFunctionComponent&lt;/h4&gt;
&lt;p&gt;â€‹	åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒReactä¼šè°ƒç”¨renderWithHookså¾—åˆ°å½“å‰fiberèŠ‚ç‚¹çš„ç»“æœå¹¶è¿”å›è¯¥ç»„ä»¶çš„å­ç»„ä»¶ã€‚å¹¶æ ¹æ®didReceiveUpdateåˆ¤æ–­è¯¥ç»„ä»¶æ ‘(è¯¥ç»„ä»¶åŠå…¶å­ç»„ä»¶)æ˜¯å¦éœ€è¦æ›´æ–°ã€‚å¦‚æœä¸éœ€è¦æ›´æ–°åˆ™åœ¨å®Œæˆè¿˜åŸç­‰æ“ä½œåè·³å‡º(bail out)ï¼Œå¦åˆ™è¿›å…¥å­ç»„ä»¶çš„reconcileæµç¨‹(reconcileChildren)ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateFunctionComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  nextProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; unmaskedContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUnmaskedContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getMaskedContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; unmaskedContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; nextChildren&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;prepareToReadContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  nextChildren &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderWithHooks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    nextProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// å¦‚æœä¸Šä¸€ä¸ªçŠ¶æ€æœ‰fiberèŠ‚ç‚¹ä¸”æ²¡æœ‰æ¥å—åˆ°æ›´æ–° å¦‚æœè°ƒç”¨äº†setStateåˆ™ä¼šåœ¨updateReducerä¸­&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// è°ƒç”¨markWorkInProgressReceivedUpdateå°†didReceiveUpdateç½®ä¸ºtrue&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;didReceiveUpdate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å› ä¸ºè¦è·³å‡ºè¿™ä¸ªç»„ä»¶çš„renderé˜¶æ®µï¼Œæ‰€ä»¥æ¸…ç©ºhooksï¼Œé‡ç½®workInProgressä¸­çš„æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;bailoutHooks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bailoutOnAlreadyFinishedWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;reconcileChildren&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    nextChildren&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;åœ¨updateFunctionComponentä¹‹å&lt;/h3&gt;
&lt;h4&gt;è¯¥ç»„ä»¶ä¸éœ€è¦æ›´æ–°(ä¿®æ”¹&amp;#x26;æ–°å¢)&lt;/h4&gt;
&lt;p&gt;å¦‚æœè¯¥ç»„ä»¶ä¸éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œåè·³å‡ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¸…ç©ºå·²ç»å…¥é˜Ÿçš„æ›´æ–°&lt;/li&gt;
&lt;li&gt;ç§»é™¤PassiveEffectå’ŒUpdateEffect&lt;/li&gt;
&lt;li&gt;ç§»é™¤å‘¼æ°”æ—¶é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bailoutHooks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  expirationTime&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// å¤ç”¨updateQueue   &lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updateQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updateQueue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ç§»é™¤ä¸¤ä¸ªtag&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;PassiveEffect &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; UpdateEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; expirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//ç§»é™¤å‘¼æ°”æ—¶é—´&lt;/span&gt;
    current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NoWork&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;å¤ç”¨ä¸Šæ¬¡context&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥å­ç»„ä»¶æ˜¯å¦æœ‰æ›´æ–°ï¼Œå¦‚æœå­ç»„ä»¶æ²¡æœ‰æ›´æ–°ï¼Œåˆ™å¯ä»¥å¯¹è¯¥ç»„ä»¶æ‰§è¡ŒcompleteUnitOfWorkæ“ä½œäº†&lt;/li&gt;
&lt;li&gt;å­ç»„ä»¶æœ‰æ›´æ–°ï¼Œé€šè¿‡current.childé‡æ–°åˆ›å»ºworkInProgress.childå¹¶ä½œä¸ºä¸‹ä¸€ä¸ªè¦å¤„ç†çš„fiberèŠ‚ç‚¹ä¼ å‡º&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bailoutOnAlreadyFinishedWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;cancelWorkTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¤ç”¨ä¸Šæ¬¡context&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;contextDependencies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;contextDependencies&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// æ£€æŸ¥å­ç»„ä»¶æ˜¯å¦æœ‰æ›´æ–°&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; childExpirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;childExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;childExpirationTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœreturn nullï¼Œè¡¨ç¤ºå­ç»„ä»¶éƒ½æ²¡æ›´æ–° åˆ™å¯ä»¥å¯¹è¯¥ç»„ä»¶æ‰§è¡ŒcompleteUnitOfWorkæ“ä½œäº†&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// è¿™ä¸ªç»„ä»¶æ²¡æœ‰æ›´æ–°ï¼Œä¸è¿‡ä»–çš„å­ç»„ä»¶æœ‰ï¼Œé€šè¿‡current.childé‡æ–°åˆ›å»ºworkInProgress.child&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;cloneChildFibers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;è¯¥ç»„ä»¶éœ€è¦æ›´æ–°(ä¿®æ”¹&amp;#x26;æ–°å¢)&lt;/h4&gt;
&lt;p&gt;â€‹	å¦‚æœè¯¥ç»„ä»¶éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆä¹Ÿè¦å…ˆæ›´æ–°å®Œä»–çš„å­ç»„ä»¶æ‰èƒ½completeè‡ªå·±å‘€ï¼Œè¯¦æƒ…çœ‹ä¸Šé¢ğŸ‘†çš„gifå›¾ã€‚å­ç»„ä»¶æ›´æ–°çš„é€»è¾‘åˆ†ä¸¤ç§ï¼Œæ ¹æ®current=== nullä¸å¦åˆ¤æ–­ï¼Œå…·ä½“é€»è¾‘çœ‹ä»£ç æ³¨é‡Š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reconcileChildren&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  nextChildren&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœè¿™ä¸ªæ˜¯ä¸ªä¹‹å‰æ²¡æ¸²æŸ“è¿‡çš„èˆ¹æ–°ç»„ä»¶ï¼ŒReactä¸ä¼šé€šè¿‡åº”ç”¨æœ€å°å‰¯ä½œç”¨å»æ›´æ–°ä»–çš„å­ç»„ä»¶ï¼Œè€Œæ˜¯åœ¨çˆ¶ç»„ä»¶æ¸²æŸ“å‰å°†å­ç»„ä»¶æ·»åŠ åˆ°çˆ¶ç»„ä»¶ä¸Šã€‚è¿™æ ·Reactå¯ä»¥é€šè¿‡ä¸è·Ÿè¸ªå‰¯ä½œç”¨ä¼˜åŒ–åè°ƒ(reconciliation)è¿‡ç¨‹ã€‚&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountChildFibers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nextChildren&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœå½“å‰(child)å­ç»„ä»¶è·Ÿæ­£åœ¨å¤„ç†(workInProgress)å­ç»„ä»¶ç›¸åŒï¼Œè¿™æ„å‘³ç€Reactè¿˜æ²¡å¼€å§‹å¤„ç†å­ç»„ä»¶ï¼Œå› æ­¤Reactä¼šå¤ç”¨ä¹‹å‰çš„é€»è¾‘å»å¤åˆ¶ä¸€ä»½æ‰€æœ‰å½“å‰(current)å­ç»„ä»¶çš„å®ä¾‹ã€‚å¦‚æœåœ¨è¿™ä¸ªåœ°æ–¹å·²ç»ç”¨å¤„ç†è¿‡çš„updateæ˜¯éæ³•çš„ï¼Œä¸¢æ‰è¿™äº›updat&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reconcileChildFibers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nextChildren&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;completeUnitOfWork&lt;/h4&gt;
&lt;p&gt;â€‹	&lt;strong&gt;ç”±äºç¯‡å¹…é™åˆ¶ï¼Œè¿™é‡Œæš‚æ—¶ä¸ä»‹ç»Reactæ›´æ–°å­ç»„ä»¶çš„é€»è¾‘ï¼Œè¿™ç‚¹æˆ‘ä»¬æ”¾åˆ°åé¢ä»”ç»†èŠï¼Œæˆ‘ä»¬è¿™æ¬¡å…³æ³¨äºè¿™ä¸ªç»„ä»¶çš„å·¥ä½œæµç¨‹ã€‚&lt;/strong&gt; é‚£ä¹ˆæˆ‘ä»¬å‡å®šæ²¡æœ‰å­ç»„ä»¶äº†ï¼ŒReactçŸ¥é“å·²ç»åˆ°è¾¾åˆ†æ”¯çš„ç»“å°¾æ‰€ä»¥ä»–å¯ä»¥å®Œæˆå½“å‰èŠ‚ç‚¹äº†ä¸”å®ŒæˆèŠ‚ç‚¹åReactä¼šå¼€å§‹å…¶å…„å¼ŸèŠ‚ç‚¹çš„å·¥ä½œæˆ–å‘çˆ¶èŠ‚ç‚¹å›æº¯ï¼Œè¿™éƒ¨åˆ†é€»è¾‘æ˜¯completeUnitOfWorkä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; returnFiber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; siblingFiber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sibling&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;siblingFiber &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœæœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œ è¿”å›å…„å¼ŸèŠ‚ç‚¹&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; siblingFiber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;returnFiber &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// çˆ¶èŠ‚ç‚¹ä¸‹å·²ç»æ²¡æœ‰éœ€è¦å·¥ä½œçš„èŠ‚ç‚¹äº†ï¼Œè¿”å›çˆ¶èŠ‚ç‚¹&lt;/span&gt;
            workInProgress &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; returnFiber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// åˆ°è¾¾æ ¹èŠ‚ç‚¹&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;scheduler&lt;/h2&gt;
&lt;h2&gt;commité˜¶æ®µ&lt;/h2&gt;</content:encoded></item><item><title><![CDATA[ç¥å¥‡çš„CSSä¸–ç•Œ(1)]]></title><description><![CDATA[å‰è¨€ ä»Šå¤©é‡åˆ°äº†ä¸€ä¸ªç¥å¥‡çš„Popoverç»„ä»¶bugï¼Œèµ·åˆè¿˜æƒ³ç”©é”…ç»™dom-alignçš„ï¼Œåæ¥å®šä½å‘ç°å¼¹å‡ºå…ƒç´ çš„å®½é«˜åœ¨æ˜¾éšæ—¶å®½é«˜ä¸åŒå¯¼è‡´dom-alignè®¡ç®—é”™è¯¯ã€‚ç»è¿‡debugå‘ç°è¿™ä¸ªå®½é«˜é—®é¢˜æ˜¯absoluteâ€¦]]></description><link>https://overreacted.io/css world(1)/</link><guid isPermaLink="false">https://overreacted.io/css world(1)/</guid><pubDate>Wed, 20 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©é‡åˆ°äº†ä¸€ä¸ªç¥å¥‡çš„Popoverç»„ä»¶bugï¼Œèµ·åˆè¿˜æƒ³ç”©é”…ç»™dom-alignçš„ï¼Œåæ¥å®šä½å‘ç°å¼¹å‡ºå…ƒç´ çš„å®½é«˜åœ¨æ˜¾éšæ—¶å®½é«˜ä¸åŒå¯¼è‡´dom-alignè®¡ç®—é”™è¯¯ã€‚ç»è¿‡debugå‘ç°è¿™ä¸ªå®½é«˜é—®é¢˜æ˜¯absoluteåµŒå¥—å¼•èµ·çš„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»¥ä¸‹ä»£ç å¯ä»¥åœ¨è¿™é‡Œï¼š&lt;a href=&quot;https://codesandbox.io/s/o4j6wq9oq9&quot;&gt;ä¼ é€é—¨&lt;/a&gt; è¯•ç©&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;åªæœ‰ä¸€å±‚absoluteçš„æƒ…å†µ&lt;/h2&gt;
&lt;p&gt;æ­£å¸¸æ–‡æ¡£æµæ˜¯ç­‰äºçˆ¶å…ƒç´ çš„å®½åº¦ã€‚&lt;code class=&quot;language-text&quot;&gt;position: abusolute&lt;/code&gt;è®©å…ƒç´ è„±ç¦»äº†æ­£å¸¸çš„æ–‡æ¡£æµï¼Œå®½åº¦ä¸ºæœ€å°å®½åº¦ï¼ˆå­å…ƒç´ æˆ–å†…å®¹æ’‘èµ·çš„å®½åº¦ï¼‰ã€‚å³é»˜è®¤å®½åº¦ä¸ºbodyçš„width:100%&lt;/p&gt;
&lt;h2&gt;å½“æœ‰ä¸¤å±‚absoluteåµŒå¥—æ—¶&lt;/h2&gt;
&lt;p&gt;å…·ä½“ä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//html&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;wrapper&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;inner&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          åˆ é™¤åéœ€ç‚¹å‡»ã€Œå‘å¸ƒã€æ‰èƒ½ç”Ÿæ•ˆå“¦ï½è¯·é—®æ˜¯å¦ç¡®å®šè¦åˆ é™¤ï¼Ÿ
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//css&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wrapper &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  position&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; absolute&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  left&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  top&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;140&lt;/span&gt;px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;inner &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  position&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; absolute&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¾—å‡ºçš„ç»“æœå¦‚ä¸‹ï¼Œå­èŠ‚ç‚¹æ˜¯è¢«å‹ç¼©åˆ°æœ€å°å®½åº¦&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190320003513604.png&quot; alt=&quot;image-20190320003513604&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡googleå¾—å‡ºä»¥ä¸‹ç»“è®º&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Because they are already nested under position: absolute; parent i.e .container and since no width is assigned, it will take the minimal width and hence&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å› ä¸ºä»–è¢«çº§è”åœ¨positionä¸ºabsoluteçš„çˆ¶å®¹å™¨ä¸­æ‰€ä»¥ä»–æ²¡æœ‰è®¾å®šé»˜è®¤å®½ï¼Œå› æ­¤ä»–ä¼šé€‰æ‹©æœ€å°çš„å®½ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘çŸ¥é“è¿™ä¸ªç»“è®ºæ˜¯æˆ‘æ˜¯æƒŠäº†ï¼ŒcssçœŸçš„æ¯”jséš¾å¤šäº†å“ˆå“ˆå“ˆ&lt;/p&gt;
&lt;h2&gt;æ‹“å±•&lt;/h2&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ç»“è®ºæˆ‘ä»¬ä¸ç¦è”æƒ³äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªè„±ç¦»äº†æ–‡æ¡£æµçš„çˆ¶å®¹å™¨è¦æ€ä¹ˆæ ·æ‰èƒ½è®¾å®šä»–çš„å®½å‘¢?&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠhtmlæ”¹æˆå¦‚ä¸‹ç»“æ„&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;wrapper&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;æˆ‘å¯ä»¥æŠŠä¸‹é¢çš„å†…å®¹æ’‘å¼€&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;inner&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          åˆ é™¤åéœ€ç‚¹å‡»ã€Œå‘å¸ƒã€æ‰èƒ½ç”Ÿæ•ˆå“¦ï½è¯·é—®æ˜¯å¦ç¡®å®šè¦åˆ é™¤ï¼Ÿ
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190320003441607.png&quot; alt=&quot;image-20190320003441607&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°è¿™ä¸ªçˆ¶å®¹å™¨çš„å®½çœŸçš„è¢«æ’‘å¼€äº†ï¼Œæ‰€ä»¥åµŒå¥—çˆ¶å®¹å™¨çš„absoluteå­å®¹å™¨ä¹Ÿæœ‰é»˜è®¤çš„å®½åº¦äº†ï¼Œå­å®¹å™¨é‡Œçš„å†…å®¹çš„å®½ä¹Ÿèƒ½éšç€çˆ¶å®¹å™¨çš„å®½å˜åŒ–è€Œå˜åŒ–&lt;/p&gt;
&lt;h2&gt;ç»“è®º&lt;/h2&gt;</content:encoded></item><item><title><![CDATA[ä½¿ç”¨ä½æ“ä½œå¿«é€Ÿå®ç°äº’æ–¥é€‰é¡¹]]></title><description><![CDATA[å‰è¨€ â€‹	äº§å“éœ€æ±‚é€‰æ‹©å™¨å®ç°å¦‚ä¸‹æ•ˆæœï¼Œå³æŸä¸€è¡Œé€‰ä¸­äº†æŸä¸€ä¸ªæ•°å€¼åé‚£ä¹ˆå…¶ä½™è¡Œè¯¥é€‰é¡¹å°±ä¸å¯ä»¥é€‰ä¸­äº†ï¼Œè¿™ç§å°±æ˜¯å¾ˆæ˜æ˜¾çš„æ ‡å¿—ä½æ“ä½œäº†ï¼Œä¸€èˆ¬ç”¨å­—ç¬¦ä¸²ï¼Œå¯¹è±¡ä»€ä¹ˆçš„ä¹Ÿå¯ä»¥è§£å†³ã€‚å°±æ˜¯é€‰ä¸­æ—¶åœ¨å­—ç¬¦ä¸²ä¸­åŠ å…¥è¯¥valueï¼Œç„¶ååœ¨éå†æ¸²æŸ“ æ—¶ç”¨æ­£åˆ™matchâ€¦]]></description><link>https://overreacted.io/ä½¿ç”¨ä½æ“ä½œå¿«é€Ÿå®ç°äº’æ–¥é€‰é¡¹/</link><guid isPermaLink="false">https://overreacted.io/ä½¿ç”¨ä½æ“ä½œå¿«é€Ÿå®ç°äº’æ–¥é€‰é¡¹/</guid><pubDate>Wed, 20 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;â€‹	äº§å“éœ€æ±‚é€‰æ‹©å™¨å®ç°å¦‚ä¸‹æ•ˆæœï¼Œå³æŸä¸€è¡Œé€‰ä¸­äº†æŸä¸€ä¸ªæ•°å€¼åé‚£ä¹ˆå…¶ä½™è¡Œè¯¥é€‰é¡¹å°±ä¸å¯ä»¥é€‰ä¸­äº†ï¼Œè¿™ç§å°±æ˜¯å¾ˆæ˜æ˜¾çš„æ ‡å¿—ä½æ“ä½œäº†ï¼Œä¸€èˆ¬ç”¨å­—ç¬¦ä¸²ï¼Œå¯¹è±¡ä»€ä¹ˆçš„ä¹Ÿå¯ä»¥è§£å†³ã€‚å°±æ˜¯é€‰ä¸­æ—¶åœ¨å­—ç¬¦ä¸²ä¸­åŠ å…¥è¯¥valueï¼Œç„¶ååœ¨éå†æ¸²æŸ“&lt;Option&gt;æ—¶ç”¨æ­£åˆ™matchä¸€ä¸‹åˆ¤æ–­æ˜¯å¦è¯¥æ¸²æŸ“å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190320202815576.png&quot; alt=&quot;image-20190320202815576&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ä½æ“ä½œé€»è¾‘&lt;/h2&gt;
&lt;p&gt; ä»¥ä¸‹é€»è¾‘ä»…ä¸ºæœ¬äºº&lt;strong&gt;å¿«é€Ÿå®ç°ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;ï¼Œæ²¡æ€ä¹ˆç»è¿‡æ‹“å±•å’Œä¼˜åŒ–ä»£ç çš„ã€‚å¦‚æœæœ‰æ›´å¥½çš„å®ç°æ–¹æ¡ˆæ¬¢è¿å¤§ä½¬æŒ‡å¯¼ï¼&lt;/p&gt;
&lt;h3&gt;å®šä¹‰tag&lt;/h3&gt;
&lt;p&gt;åœ¨æ¯ä¸€ä¸ªé€‰é¡¹å¤šä¸€ä¸ªtagé¡¹ï¼Œå…¶å€¼ä¸ºäºŒè¿›åˆ¶å…¨éƒ¨0å¹¶åªæœ‰ä¸€ä½ä¸º1çš„numberï¼Œä¸”å”¯ä¸€ã€‚currentSelectä½œä¸ºè®°å½•å½“å‰çš„tagæ€»å’Œ&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; pointMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;APP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;APP&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;APP&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    tag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b0001&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;M&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;M&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    tag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b0010&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;WQ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;WQ&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;WQ&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    tag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b0100&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;MINI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;å°ç¨‹åº&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;MINI&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    tag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b1000&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;æ·»åŠ /ä¿®æ”¹é€‰é¡¹&lt;/h3&gt;
&lt;p&gt;å½“å‰tag ^ è¢«å–æ¶ˆé€‰æ‹©çš„tag(å¦‚æœæœ‰çš„è¯) | å½“å‰é€‰ä¸­çš„tag &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;currentData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentSelect &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt; pointMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;oldItemChannel &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; oldItemChannel &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; tag&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;å–æ¶ˆé€‰æ‹©/åˆ é™¤è¡Œ&lt;/h3&gt;
&lt;p&gt;å½“å‰tag ^ è¢«å–æ¶ˆé€‰æ‹©çš„tag&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;currentData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentSelect &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt; pointMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;ç®€å•è§£æ&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. åˆ é™¤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‡å®šæœ‰ä¸‰è¡Œï¼Œä¸”å½“å‰é€‰æ‹©äº†APPï¼ŒMï¼ŒWQ é‚£ä¹ˆcurrentSelectæ˜¯0b0111ï¼Œå¦‚æœåˆ é™¤WQè¡Œåˆ™è¿ç®—ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;â€‹	0b0111 ^ 0b0100 = 0b011&lt;/p&gt;
&lt;p&gt;ç›¸åŒçš„ä½ç½®0ï¼Œä¸åŒçš„ä½ç½®1&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. æ·»åŠ &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå¤ªç®€å•äº†ï¼Œå°±æ˜¯æœ‰1çš„ä½å°±ç½®1&lt;/p&gt;</content:encoded></item><item><title><![CDATA[why hooksï¼ˆä¸€ï¼‰]]></title><description><![CDATA[å‰è¨€ â€‹	ç®€å•è¯´ä¸‹ä¸ºä»€ä¹ˆReacté€‰æ‹©å‡½æ•°å¼ç»„ä»¶ï¼Œä¸»è¦æ˜¯classç»„ä»¶æ¯”è¾ƒå†—ä½™ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°å†™æ³•ä¸å‹å¥½ï¼Œéªšå†™æ³•å¤šï¼Œfunctionalç»„ä»¶æ›´ç¬¦åˆReactç¼–ç¨‹æ€æƒ³ç­‰ç­‰ç­‰ã€‚æ›´å…·ä½“çš„å¯ä»¥æ‹œè¯»danå¤§ç¥çš„blog: ä¼ é€é—¨ ã€‚å…¶ä¸­ Function components captureâ€¦]]></description><link>https://overreacted.io/why hooks/</link><guid isPermaLink="false">https://overreacted.io/why hooks/</guid><pubDate>Sun, 17 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;â€‹	ç®€å•è¯´ä¸‹ä¸ºä»€ä¹ˆReacté€‰æ‹©å‡½æ•°å¼ç»„ä»¶ï¼Œä¸»è¦æ˜¯classç»„ä»¶æ¯”è¾ƒå†—ä½™ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°å†™æ³•ä¸å‹å¥½ï¼Œéªšå†™æ³•å¤šï¼Œfunctionalç»„ä»¶æ›´ç¬¦åˆReactç¼–ç¨‹æ€æƒ³ç­‰ç­‰ç­‰ã€‚æ›´å…·ä½“çš„å¯ä»¥æ‹œè¯»danå¤§ç¥çš„blog:&lt;a href=&quot;https://overreacted.io/how-are-function-components-different-from-classes/&quot;&gt;ä¼ é€é—¨&lt;/a&gt;ã€‚å…¶ä¸­&lt;strong&gt;Function components capture the rendered values&lt;/strong&gt;è¿™å¥ååˆ†ç²¾è¾Ÿçš„é“å‡ºå‡½æ•°å¼ç»„ä»¶çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ä½†æ˜¯åœ¨16.8ä¹‹å‰reactçš„å‡½æ•°å¼ç»„ä»¶ååˆ†ç¾¸å¼±ï¼ŒåŸºæœ¬åªèƒ½ä½œç”¨äºçº¯å±•ç¤ºç»„ä»¶ï¼Œä¸»è¦å› ä¸ºç¼ºå°‘stateå’Œç”Ÿå‘½å‘¨æœŸã€‚æœ¬äººæ›¾ç»åœ¨hookså‡ºæ¥å‰è´Ÿè´£è¿‡çº¯å‡½æ•°å¼çš„reacté¡¹ç›®ï¼Œæ‰€æœ‰çŠ¶æ€å¤„ç†éƒ½å¿…é¡»åœ¨reducerä¸­è¿›è¡Œï¼Œæ‰€æœ‰å‰¯ä½œç”¨éƒ½åœ¨sagaä¸­æ‰§è¡Œï¼Œå¯ä»¥è¯´æ˜¯ååˆ†è‰°è¾›çš„ç»å†äº†ã€‚åœ¨hookså‡ºæ¥åæˆ‘åœ¨å…¬å¸çš„ä¸€ä¸ªå°ä¸­å°é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè½åœ°æ•ˆæœä¸é”™ï¼Œä»£ç é‡æ˜¾è‘—å‡å°‘çš„åŒæ—¶æå‡äº†ä»£ç çš„å¯è¯»æ€§ã€‚å› ä¸ºé€šè¿‡custom hookså¯ä»¥æ›´å¥½åœ°å‰¥ç¦»ä»£ç ç»“æ„ï¼Œä¸ä¼šåƒä»¥å‰ç±»ç»„ä»¶é‚£æ ·åœ¨cDUç­‰ç”Ÿå‘½å‘¨æœŸå †äº†ä¸€å¤§å †é€»è¾‘ï¼Œåœ¨å‘½ä»¤å¼ä»£ç å’Œå£°æ˜å¼ä»£ç ä¸­æœ‰ä¸€ä¸ªè‰¯æ€§çš„è¾¹ç•Œã€‚&lt;/p&gt;
&lt;h2&gt;useStateåœ¨Reactä¸­æ˜¯æ€ä¹ˆå®ç°çš„&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Hooks take some getting used to â€” and especially at the boundary of imperative and declarative code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€‹	å¦‚æœå¯¹hooksä¸å¤ªäº†è§£çš„å¯ä»¥å…ˆçœ‹çœ‹è¿™ç¯‡æ–‡ç« :&lt;a href=&quot;https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e&quot;&gt;å‰æƒ…æè¦&lt;/a&gt;ï¼Œååˆ†ç®€æ˜çš„ä»‹ç»äº†hooksçš„æ ¸å¿ƒåŸç†ï¼Œä½†æ˜¯æˆ‘å¯¹useEffectï¼ŒuseRefç­‰é’©å­çš„å®ç°æ¯”è¾ƒå¥½å¥‡ï¼Œæ‰€ä»¥å¼€å§‹å•ƒèµ·äº†æºç ï¼Œä¸‹é¢æˆ‘ä¼šç»“åˆæºç ä»‹ç»useStateçš„åŸç†ã€‚useStateå…·ä½“é€»è¾‘åˆ†æˆä¸‰éƒ¨åˆ†ï¼šmountStateï¼Œdispatchï¼Œ updateState&lt;/p&gt;
&lt;h3&gt;hookçš„ç»“æ„&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆçš„æ˜¯hooksçš„ç»“æ„ï¼Œhooksæ˜¯æŒ‚è½½åœ¨ç»„ä»¶Fiberç»“ç‚¹ä¸ŠmemoizedStateçš„ï¼Œå…³äºFiberç»“ç‚¹å¯ä»¥çœ‹çœ‹æˆ‘çš„å¦ä¸€ç¯‡ï¼š&lt;a href=&quot;https://xuzhanhh.com/Inside%20Fiber/&quot;&gt;ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//hookçš„ç»“æ„&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; type Hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  memoizedState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//ä¸Šä¸€æ¬¡çš„state&lt;/span&gt;
  baseState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//å½“å‰state&lt;/span&gt;
  baseUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Update&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; any&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// update func&lt;/span&gt;
  queue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; UpdateQueue&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; any&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//ç”¨äºç¼“å­˜å¤šæ¬¡action&lt;/span&gt;
  next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Hook &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//é“¾è¡¨&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;renderWithHooks&lt;/h3&gt;
&lt;p&gt;åœ¨reconcilerä¸­å¤„ç†å‡½æ•°å¼ç»„ä»¶çš„å‡½æ•°æ˜¯renderWithHooksï¼Œå…¶ç±»å‹æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;renderWithHooks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//å½“å‰çš„fiberç»“ç‚¹&lt;/span&gt;
  workInProgress&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
  Component&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//jsxä¸­ç”¨&amp;lt;&gt;è°ƒç”¨çš„å‡½æ•°&lt;/span&gt;
  props&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  refOrContext&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  nextRenderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//éœ€è¦åœ¨ä»€ä¹ˆæ—¶å€™ç»“æŸ&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨renderWithHooksï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//ä»memoizedStateä¸­å–å‡ºhooks&lt;/span&gt;
nextCurrentHook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; current &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;token comment&quot;&gt;//åˆ¤æ–­é€šè¿‡æœ‰æ²¡æœ‰hooksåˆ¤æ–­æ˜¯mountè¿˜æ˜¯updateï¼Œä¸¤è€…çš„å‡½æ•°ä¸åŒ&lt;/span&gt;
ReactCurrentDispatcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      nextCurrentHook &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; HooksDispatcherOnMount
        &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HooksDispatcherOnUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//æ‰§è¡Œä¼ å…¥çš„typeå‡½æ•°&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; refOrContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//æ‰§è¡Œå®Œå‡½æ•°åçš„dispatcherå˜æˆåªèƒ½è°ƒç”¨contextçš„&lt;/span&gt;
ReactCurrentDispatcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ContextOnlyDispatcher&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;useStateæ„å»ºæ—¶æµç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;mountState&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨HooksDispatcherOnMountä¸­ï¼ŒuseStateè°ƒç”¨çš„æ˜¯ä¸‹é¢çš„mountStateï¼Œä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„hookå¹¶ä½¿ç”¨é»˜è®¤å€¼åˆå§‹åŒ–å¹¶ç»‘å®šå…¶è§¦å‘å™¨ï¼Œå› ä¸ºuseStateåº•å±‚æ˜¯useReducerï¼Œæ‰€ä»¥æ•°ç»„ç¬¬äºŒä¸ªå€¼è¿”å›çš„æ˜¯dispatchã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; BasicStateAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; mountState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  initialState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dispatch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;BasicStateAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountWorkInProgressHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//å¦‚æœå…¥å‚æ˜¯funcåˆ™ä¼šè°ƒç”¨ï¼Œä½†æ˜¯ä¸æä¾›å‚æ•°ï¼Œå¸¦å‚æ•°çš„éœ€è¦åŒ…ä¸€å±‚&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; initialState &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    initialState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initialState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//ä¸Šä¸€ä¸ªstateå’ŒåŸºæœ¬(å½“å‰)stateéƒ½åˆå§‹åŒ–&lt;/span&gt;
  hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;queue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    last&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    dispatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    eagerReducer&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; basicStateReducer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// useStateä½¿ç”¨åŸºç¡€reducer&lt;/span&gt;
    eagerState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//è¿”å›è§¦å‘å™¨&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dispatch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//useStateåº•å±‚æ˜¯useReducerï¼Œæ‰€ä»¥typeæ˜¯BasicStateAction&lt;/span&gt;
    BasicStateAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatchAction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//ç»‘å®šå½“å‰fiberç»“ç‚¹å’Œqueue&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentlyRenderingFiber&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    queue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;mountWorkInProgressHook&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°æ˜¯mountStateæ—¶è°ƒç”¨çš„æ„å»ºhookçš„æ–¹æ³•ï¼Œåœ¨åˆå§‹åŒ–å®Œæ¯•åä¼šè¿æ¥åˆ°å½“å‰hook.nextï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mountWorkInProgressHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Hook &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    memoizedState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    baseState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    queue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    baseUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgressHook &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªhook&lt;/span&gt;
    firstWorkInProgressHook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgressHook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾&lt;/span&gt;
    workInProgressHook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgressHook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; workInProgressHook&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;dispatchåˆ†å‘å‡½æ•°&lt;/h3&gt;
&lt;p&gt;â€‹	åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼ŒuseStateåº•å±‚æ˜¯useReducerï¼Œæ‰€ä»¥è¿”å›çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯dispatchå‡½æ•°ï¼Œå…¶ä¸­çš„è®¾è®¡ååˆ†å·§å¦™ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç :&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setData&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;first&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;second&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;third&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190317151730512.png&quot; alt=&quot;image-20190317151730512&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€æ¬¡setDataåï¼Œ hooksçš„ç»“æ„å¦‚ä¸Šå›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190317152006773.png&quot; alt=&quot;image-20190317152006773&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬äºŒæ¬¡setDataåï¼Œ hooksçš„ç»“æ„å¦‚ä¸Šå›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190317152401946.png&quot; alt=&quot;image-20190317152401946&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬ä¸‰æ¬¡setDataåï¼Œ hooksçš„ç»“æ„å¦‚ä¸Šå›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/image-20190318114449227.png&quot; alt=&quot;image-20190318114449227&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šåœ¨dispatcherä¸­è§¦å‘reducerè€Œæ˜¯å°†actionå­˜å…¥updateä¸­åœ¨updateStateä¸­å†æ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœåœ¨reactæ²¡æœ‰é‡æ¸²æŸ“éœ€æ±‚çš„å‰æä¸‹æ˜¯ä¼šæå‰è®¡ç®—stateå³eagerStateã€‚ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„ä¸€ç¯ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; dispatchAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  fiber&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  queue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; UpdateQueue&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; alternate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fiber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alternate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;flushPassiveEffects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//è·å–å½“å‰æ—¶é—´å¹¶è®¡ç®—å¯ç”¨æ—¶é—´&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; currentTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;requestCurrentTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; expirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;computeExpirationForFiber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fiber&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Update&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      expirationTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      action&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      eagerReducer&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      eagerState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//ä¸‹é¢çš„ä»£ç å°±æ˜¯ä¸ºäº†æ„å»ºqueue.lastæ˜¯æœ€æ–°çš„æ›´æ–°ï¼Œç„¶ålast.nextå¼€å§‹æ˜¯æ¯ä¸€æ¬¡çš„action&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å–å‡ºlast&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// è‡ªåœ†&lt;/span&gt;
      update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; last&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        
        update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      last&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      fiber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; NoWork &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alternate &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; alternate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; NoWork&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// å½“å‰é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿›å…¥renderé˜¶æ®µå‰æå‰è®¡ç®—å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å¦‚æœæ–°çš„çŠ¶æ€å’Œå½“å‰çŠ¶æ€ç›¸åŒï¼Œåˆ™å¯ä»¥é€€å‡ºé‡æ¸²æŸ“&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; lastRenderedReducer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRenderedReducer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ä¸Šæ¬¡æ›´æ–°å®Œåçš„reducer&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastRenderedReducer &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; prevDispatcher&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__DEV__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          prevDispatcher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ReactCurrentDispatcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// æš‚å­˜dispatcher&lt;/span&gt;
          ReactCurrentDispatcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; InvalidNestedHooksDispatcherOnUpdateInDEV&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; currentState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRenderedState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// è®¡ç®—ä¸‹æ¬¡state&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; eagerState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lastRenderedReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// åœ¨updateå¯¹è±¡ä¸­å­˜å‚¨é¢„è®¡ç®—çš„å®Œæ•´çŠ¶æ€å’Œreducerï¼Œå¦‚æœåœ¨è¿›å…¥renderé˜¶æ®µå‰reduceræ²¡æœ‰å˜åŒ–é‚£ä¹ˆå¯ä»¥æœç”¨eagerStateè€Œä¸ç”¨é‡æ–°å†æ¬¡è°ƒç”¨reducer&lt;/span&gt;
          update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eagerReducer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lastRenderedReducer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eagerState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; eagerState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eagerState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currentState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// åœ¨åç»­çš„æ—¶é—´ä¸­ï¼Œå¦‚æœè¿™ä¸ªç»„ä»¶å› åˆ«çš„åŸå› è¢«é‡æ¸²æŸ“ä¸”åœ¨é‚£æ—¶reduceræ›´å˜åï¼Œä»æœ‰å¯èƒ½é‡å»ºè¿™æ¬¡æ›´æ–°&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// Suppress the error. It will throw again in the render phase.&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__DEV__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            ReactCurrentDispatcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevDispatcher&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;scheduleWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fiber&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;useStateæ›´æ–°æ—¶æµç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;updateReducer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹	å› ä¸ºuseStateåº•å±‚æ˜¯useReducerï¼Œæ‰€ä»¥åœ¨æ›´æ–°æ—¶çš„æµç¨‹(å³é‡æ¸²æŸ“ç»„ä»¶å)æ˜¯è°ƒç”¨updateReducerçš„ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; updateState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  initialState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dispatch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;BasicStateAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;basicStateReducer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æ‰€ä»¥å…¶reducerååˆ†ç®€å•&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; basicStateReducer&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BasicStateAction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; action &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æˆ‘ä»¬å…ˆæŠŠå¤æ‚æƒ…å†µæŠ›å¼€ï¼Œè·‘é€šupdateReduceræµç¨‹&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; updateReducer&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  reducer&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  initialArg&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  init&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;I&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dispatch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// è·å–å½“å‰hook,queue&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hook &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateWorkInProgressHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;queue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRenderedReducer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; reducer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// actioné˜Ÿåˆ—çš„æœ€åä¸€ä¸ªæ›´æ–°&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// æœ€åä¸€ä¸ªæ›´æ–°æ˜¯åŸºæœ¬çŠ¶æ€&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; baseUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; baseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ²¡å¤„ç†çš„æ›´æ–°&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;baseUpdate &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ç¬¬ä¸€æ¬¡æ›´æ–°æ—¶ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªè‡ªåœ†queue.last.next = queue.firstã€‚å½“ç¬¬ä¸€æ¬¡updateæäº¤åï¼ŒbaseUpdateä¸å†ä¸ºç©ºå³å¯è·³å‡ºé˜Ÿåˆ—&lt;/span&gt;
      last&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; baseUpdate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; last&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; newState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; baseState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; newBaseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; newBaseUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; prevUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; baseUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; didSkip &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; updateExpirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expirationTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updateExpirationTime &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// ä¼˜å…ˆçº§ä¸è¶³ï¼Œè·³è¿‡è¿™æ¬¡æ›´æ–°ï¼Œå¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è·³è¿‡æ›´æ–°ï¼Œä¸Šä¸€ä¸ªupdate/stateæ˜¯newBaseupdate/state&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;didSkip&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          didSkip &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          newBaseUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          newBaseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// æ›´æ–°ä¼˜å…ˆçº§&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updateExpirationTime &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; remainingExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          remainingExpirationTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; updateExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// å¤„ç†æ›´æ–°&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eagerReducer &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; reducer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// å¦‚æœæ›´æ–°è¢«æå‰å¤„ç†äº†ä¸”reducerè·Ÿå½“å‰reduceråŒ¹é…ï¼Œå¯ä»¥å¤ç”¨eagerState&lt;/span&gt;
          newState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eagerState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// å¾ªç¯è°ƒç”¨reducer&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; action &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          newState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      prevUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      update &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;update &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;didSkip&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      newBaseUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      newBaseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// åªæœ‰åœ¨å‰åstateå˜äº†æ‰ä¼šæ ‡è®°&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;markWorkInProgressReceivedUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newBaseUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newBaseState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRenderedState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dispatch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;hook&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;markWorkInProgressReceivedUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  didReceiveUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;åè®°&lt;/h2&gt;
&lt;p&gt;â€‹	ä½œä¸ºç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘é€‰æ‹©äº†æœ€å¸¸ç”¨çš„hookså¼€å§‹ï¼ŒæŠ›å¼€æå‰è®¡ç®—åŠä¸react-reconcilerçš„äº’åŠ¨ï¼Œæ•´ä¸ªæµç¨‹æ˜¯ååˆ†æ¸…æ™°æ˜“æ‡‚çš„ã€‚mountçš„æ—¶å€™æ„å»ºé’©å­ï¼Œè§¦å‘dispatchæ—¶æŒ‰åºæ’å…¥updateã€‚updateStateçš„æ—¶å€™å†æŒ‰åºè§¦å‘reducerã€‚å¯ä»¥è¯´å°±æ˜¯ä¸€ä¸ªç®€å•çš„reduxã€‚ä½†æ˜¯ä½œä¸ºç³»åˆ—çš„å¼€ç¯‡æˆ‘è®¤ä¸ºçŸ¥è¯†é‡å·²ç»è¾¾åˆ°è¦æ±‚äº†xd&lt;/p&gt;</content:encoded></item><item><title><![CDATA[All about generator]]></title><description><![CDATA[coçš„åŸºæœ¬å®ç°]]></description><link>https://overreacted.io/All about generator/</link><guid isPermaLink="false">https://overreacted.io/All about generator/</guid><pubDate>Wed, 23 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;coçš„åŸºæœ¬å®ç°&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://api.github.com/users/github&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; data
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gen&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ctx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; val &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;temp&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; val&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;val&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;val&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      val&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;co&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;!!!!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Inside Fiber]]></title><description><![CDATA[read this createFiberFromTypeAndProps â€‹	å½“ä¸€ä¸ªReactå…ƒç´ ç¬¬ä¸€æ¬¡è¢«è½¬æ¢æˆfiber nodeæ—¶ï¼ŒReactä½¿ç”¨createFiberFromTypeAndPropsã€‚åœ¨éšåçš„æ›´æ–°ä¸­Reactä¼šé‡ç”¨fiber nodeâ€¦]]></description><link>https://overreacted.io/Inside Fiber/</link><guid isPermaLink="false">https://overreacted.io/Inside Fiber/</guid><pubDate>Sat, 22 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e&quot;&gt;read this&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;createFiberFromTypeAndProps&lt;/h2&gt;
&lt;p&gt;â€‹	å½“ä¸€ä¸ªReactå…ƒç´ ç¬¬ä¸€æ¬¡è¢«è½¬æ¢æˆfiber nodeæ—¶ï¼ŒReactä½¿ç”¨createFiberFromTypeAndPropsã€‚åœ¨éšåçš„æ›´æ–°ä¸­Reactä¼šé‡ç”¨fiber nodeä¸”åªæ›´æ–°ä»å½“å‰Reactå…ƒç´ è·å–å¿…é¡»çš„å±æ€§ã€‚Reactè¿˜ä¼šæ ¹æ®keyå±æ€§åœ¨ç›®å½•ä¸­ç§»åŠ¨ç»“ç‚¹ä½ç½®æˆ–åˆ é™¤å®ƒå¦‚æœreactå…ƒç´ çš„renderæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æŸ¥çœ‹&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactChildFiber.js#L239&quot;&gt;&lt;strong&gt;ChildReconciler&lt;/strong&gt;&lt;/a&gt;æ–¹æ³•å¾—åˆ°æ‰€æœ‰è¡ŒåŠ¨å’ŒReacté’ˆå¯¹å½“å‰çš„fiberç»“ç‚¹ç±»å‹æ‰§è¡Œçš„ç›¸åº”çš„æ–¹æ³•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;currentå’ŒworkInProgress tree&lt;/h2&gt;
&lt;p&gt;â€‹	ç¬¬ä¸€æ¬¡renderç»“æŸåï¼ŒReactä¼šç”Ÿæˆä¸€ä¸ªfiber treeæ˜ å°„åº”ç”¨çš„çŠ¶æ€å’ŒUIï¼Œè¿™ä¸ªtreeä¸€èˆ¬å«&lt;code class=&quot;language-text&quot;&gt;current&lt;/code&gt;ã€‚å½“Reactå‡†å¤‡å¼€å§‹æ›´æ–°æ—¶ä¼šæ„å»ºä¸€ä¸ª&lt;code class=&quot;language-text&quot;&gt;workInProgress&lt;/code&gt;treeï¼Œåæ˜ å°†è¢«æ¸²æŸ“åˆ°å±å¹•çš„å°†æ¥çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	æ‰€æœ‰çš„fibersä¸Šçš„å·¥ä½œéƒ½ä¼šåœ¨workInProgress treeä¸Šæ‰§è¡Œã€‚å½“Reactéå†current treeæ—¶ï¼Œæ¯ä¸€ä¸ªå­˜åœ¨çš„ç»“ç‚¹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªalternate nodeæ¥æ„æˆworkInProgress treeã€‚å½“æ›´æ–°å®Œæˆä¸”æ‰€æœ‰çš„ç›¸å…³å·¥ä½œå®Œæˆæ—¶ï¼ŒReactå‡†å¤‡å°†alternate treeæ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚ä¸€æ—¦workInProgress treeè¢«æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œä»–å°±ä¼šå˜æˆcurrent treeã€‚&lt;/p&gt;
&lt;p&gt;â€‹	åœ¨ä»£ç ä¸­ä½ ä¼šè§åˆ°å¾ˆå¤šå‡½æ•°éœ€è¦currentå’ŒworkInProgress treeï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateHostComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æ¯ä¸€ä¸ªfiberç»“ç‚¹çš„alternateå±æ€§ä¼šæ˜¯å®ƒåœ¨å¦å¤–ä¸€é¢—æ ‘ä¸Šçš„å‰¯æœ¬çš„å¼•ç”¨ã€‚ä¸€ä¸ªcurrent treeä¸Šçš„ç»“ç‚¹ä¼šæŒ‡å‘workInprogress treeä¸Šçš„ç»“ç‚¹ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/p&gt;
&lt;h2&gt;Side-effects &amp;#x26;&amp;#x26; Effects list&lt;/h2&gt;
&lt;p&gt;â€‹	æ¯ä¸€ä¸ªfiberç»“ç‚¹å¯ä»¥æœ‰ä¸ä¹‹ç›¸å…³çš„ä½œç”¨ï¼Œè¿™äº›è¢«æ”¾åœ¨effectTagå­—æ®µä¸­ã€‚æ‰€ä»¥fiberçš„effectsåŸºæœ¬å®šä¹‰äº†å®ä¾‹åœ¨æ›´æ–°å®Œåéœ€è¦å¤„ç†çš„&lt;a href=&quot;https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/packages/shared/ReactSideEffectTags.js&quot;&gt;å·¥ä½œ&lt;/a&gt;ã€‚ä¾‹å¦‚hostç»„ä»¶ï¼ˆDOM å…ƒç´ ï¼‰ä¼šæœ‰adding, updating or removing elementsã€‚ç±»ç»„ä»¶ä¼šæœ‰æ›´æ–°refsï¼Œè°ƒç”¨cDMå’ŒcDUç”Ÿå‘½å‘¨æœŸã€‚&lt;/p&gt;
&lt;p&gt;â€‹	Reactä¼šæ„å»ºä¸€ä¸ªæœ‰effectsçš„fiberç»“ç‚¹çš„çº¿æ€§åˆ—è¡¨å»å¿«é€Ÿéå†ã€‚éå†çº¿æ€§åˆ—è¡¨æ¯”éå†æ ‘å¿«å¾ˆå¤šï¼Œä¸”æ²¡å¿…è¦èŠ±è´¹æ—¶é—´åœ¨æ²¡æœ‰å‰¯ä½œç”¨çš„ç»“ç‚¹ä¸Šã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯&lt;code class=&quot;language-text&quot;&gt;finishedWork&lt;/code&gt;treeçš„å­é›†ä¸”å®ƒåœ¨currentå’ŒworkInProgress treeä¸­ä½¿ç”¨nextEffectå±æ€§é“¾æ¥è€Œä¸æ˜¯childå±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æ›´æ–°ä¼šå¯¼è‡´&lt;code class=&quot;language-text&quot;&gt;c2&lt;/code&gt;æ’å…¥åˆ°DOMä¸­ï¼Œ&lt;code class=&quot;language-text&quot;&gt;d2&lt;/code&gt;å’Œ&lt;code class=&quot;language-text&quot;&gt;c1&lt;/code&gt;æ”¹å˜DOMå±æ€§ï¼Œ&lt;code class=&quot;language-text&quot;&gt;b2&lt;/code&gt;è§¦å‘ç”Ÿå‘½å‘¨æœŸã€‚effect listä¼šè¿æ¥ä»–ä»¬æ‰€ä»¥Reactå¯ä»¥è·³è¿‡å…¶ä»–ç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pjpqjxkf6.bkt.clouddn.com/1%2AQ0pCNcK1FfCttek32X_l7A.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pjpqjxkf6.bkt.clouddn.com/1%2AmbeZ1EsfMsLUk-9hOYyozw.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å¾—åˆ°ï¼ŒReactä¼šä»childrenå†åˆ°parentsæ‰§è¡Œeffectsã€‚&lt;/p&gt;
&lt;h2&gt;Fiber treeçš„æ ¹èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;Reactå¯¹æ¯ä¸€ä¸ªè¿™äº›containeråˆ›å»º&lt;a href=&quot;https://github.com/facebook/react/blob/0dc0ddc1ef5f90fe48b58f1a1ba753757961fc74/packages/react-reconciler/src/ReactFiberRoot.js#L31&quot;&gt;fiber root&lt;/a&gt;ï¼Œä½ å¯ä»¥è¿™æ ·æ‰¾åˆ°ä»–ä»¬&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fiberRoot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_reactRootContainer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_internalRoot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; fiber rootçš„currentå±æ€§ä¸­æ˜¯Reactå­˜æ”¾fiber treeçš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hostRootFiberNode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fiberRoot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;fiber treeä¼šç”¨&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/shared/ReactWorkTags.js#L34&quot;&gt;ä¸€ç§ç‰¹åˆ«çš„ç±»å‹çš„fiberç»“ç‚¹&lt;/a&gt;å¼€å§‹ï¼š&lt;code class=&quot;language-text&quot;&gt;HostRoot&lt;/code&gt;ï¼Œé€šè¿‡&lt;code class=&quot;language-text&quot;&gt;stateNode&lt;/code&gt;å¯ä»¥ä»&lt;code class=&quot;language-text&quot;&gt;HostRoot&lt;/code&gt;fiberç»“ç‚¹è¿”å›FiberRoot&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;fiberRoot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stateNode &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; fiberRoot&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Fiber node structure&lt;/h2&gt;
&lt;h3&gt;stateNode&lt;/h3&gt;
&lt;p&gt;ä¿æŒfiberå¯¹æœ¬åœ°çŠ¶æ€çš„è”ç³»ï¼Œ ä¿å­˜å¯¹ç»„ä»¶çš„ç±»å®ä¾‹ï¼ŒDOMèŠ‚ç‚¹æˆ–ä¸fiberèŠ‚ç‚¹å…³è”çš„å…¶ä»–Reactå…ƒç´ ç±»å‹çš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;h3&gt;type&lt;/h3&gt;
&lt;p&gt;å®šä¹‰ä¸æ­¤fiberèŠ‚ç‚¹å…³è”çš„åŠŸèƒ½æˆ–ç±»ï¼Œå¯¹äºclassç»„ä»¶ï¼Œå®ƒæŒ‡å‘constructorå‡½æ•°ï¼Œå¯¹äºDOMå…ƒç´ ï¼Œå®ƒæ˜¯HTML tagã€‚&lt;/p&gt;
&lt;h3&gt;tag&lt;/h3&gt;
&lt;p&gt;å®šä¹‰&lt;a href=&quot;https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/shared/ReactWorkTags.js&quot;&gt;fiberèŠ‚ç‚¹çš„ç±»å‹&lt;/a&gt;ã€‚è¢«ç”¨äºå†³å®šéœ€è¦åœ¨reconciliationä¸­åšä»€ä¹ˆå·¥ä½œã€‚&lt;/p&gt;
&lt;h3&gt;updateQueue&lt;/h3&gt;
&lt;p&gt;çŠ¶æ€æ›´æ–°ï¼Œå›è°ƒå’ŒDOMæ›´æ–°çš„é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h3&gt;memoizedState&lt;/h3&gt;
&lt;p&gt;fiberç”¨äºåˆ›å»ºè¾“å‡ºçš„stateã€‚å¤„ç†æ›´æ–°æ—¶ï¼Œå®ƒä¼šåæ˜ å½“å‰åœ¨å±å¹•ä¸Šå‘ˆç°çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h3&gt;memoizedProps&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šä¸€æ¬¡renderä¸­fiberç”¨äºåˆ›å»ºè¾“å‡ºçš„props&lt;/p&gt;
&lt;h3&gt;pendingProps&lt;/h3&gt;
&lt;p&gt;å·²ç»ä»reactæ–°å…ƒç´ ä¸­æ›´æ–°çš„propså¹¶ä¸”éœ€è¦åº”ç”¨äºå­ç»„ä»¶æˆ–DOMå…ƒç´ &lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/6e4f7c788603dac7fccd227a4852c110b072fe16/packages/react-reconciler/src/ReactFiber.js#L78&quot;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°å®Œæ•´çš„fiberç»“æ„&lt;/p&gt;
&lt;h2&gt;ä¸»è¦æµç¨‹&lt;/h2&gt;
&lt;h3&gt;renderé˜¶æ®µ&lt;/h3&gt;
&lt;p&gt;reconcileé€šå¸¸ä»&lt;code class=&quot;language-text&quot;&gt;HostRoot&lt;/code&gt;fiberç»“ç‚¹ï¼Œå¹¶é€šè¿‡&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L1132&quot;&gt;renderRoot&lt;/a&gt;æ–¹æ³•å¼€å§‹ã€‚ä½†æ˜¯ï¼ŒReactä¼šå¿«é€Ÿè·³è¿‡å·²ç»å¤„ç†è¿‡çš„fiberèŠ‚ç‚¹çŸ¥é“ä»–æ‰¾åˆ°ä¸€ä¸ªæœªå®Œæˆå·¥ä½œçš„ç»“ç‚¹ã€‚ &lt;/p&gt;
&lt;h4&gt;work loopçš„ä¸»è¦æ­¥éª¤&lt;/h4&gt;
&lt;p&gt;â€‹	æ‰€æœ‰fiberèŠ‚ç‚¹Â &lt;a href=&quot;https://github.com/facebook/react/blob/f765f022534958bcf49120bf23bc1aa665e8f651/packages/react-reconciler/src/ReactFiberScheduler.js#L1136&quot;&gt;åœ¨work loopä¸­&lt;/a&gt;è¢«å¤„ç†ï¼Œè¿™é‡Œæ˜¯åŒæ­¥éƒ¨åˆ†çš„work loopå®ç°ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;workLoop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isYieldy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isYieldy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;performUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextUnitOfWork&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;nextUnitOfWork&lt;/code&gt;ä¼šä¿ç•™å¯¹&lt;code class=&quot;language-text&quot;&gt;workInProgress&lt;/code&gt;treeä¸­éœ€è¦å¤„ç†çš„fiberèŠ‚ç‚¹çš„å¼•ç”¨ã€‚å½“Reactéå†fiber treeæ—¶ï¼Œä¼šç”¨è¿™ä¸ªå˜é‡å»çŸ¥æ™“è¿™é‡Œæ˜¯å¦æœ‰å…¶ä»–æœªå®Œæˆå·¥ä½œçš„fiberç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¼šæœ‰å››ä¸ªä¸»è¦å‡½æ•°ç”¨äºéå†treeå’Œå‘èµ·æˆ–å®Œæˆå·¥ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L1056&quot;&gt;performUnitOfWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js#L1489&quot;&gt;beginWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L879&quot;&gt;completeUnitOfWork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberCompleteWork.js#L532&quot;&gt;completeWork&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://pjpqjxkf6.bkt.clouddn.com/1%2AA3-yF-3Xf47nPamFpRm64w.gif&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://vimeo.com/302222454&quot;&gt;è¿™é‡Œæ˜¯è§†é¢‘&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;performUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;work performed for &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	performUnitOfWorkä»workInProgress treeä¸­æ¥æ”¶ä¸€ä¸ªfiberèŠ‚ç‚¹ç„¶åå¼€å§‹è°ƒç”¨beginWorkå·¥ä½œã€‚beginWorkæ˜¯å¼€å§‹æ‰€æœ‰éœ€è¦æ‰§è¡Œè¡ŒåŠ¨çš„å‡½æ•°ï¼Œä¸ºäº†ç¤ºèŒƒï¼Œæˆ‘ä»¬ç®€å•è¾“å‡ºfiberçš„åå­—å»è®°å½•å·¥ä½œå·²ç»å®Œæˆã€‚beginWorkæ€»æ˜¯ä¼šè¿”å›ä¸‹ä¸€ä¸ªå¤„ç†å¾ªç¯çš„å­©å­æˆ–è€…nullï¼Œ&lt;/p&gt;
&lt;p&gt;â€‹	å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå­©å­ï¼Œä»–ä¼šèµ‹äºˆworkLoopä¸­çš„nextUnitOfWorkã€‚å¦‚æœæ²¡æœ‰å­©å­ï¼ŒReactçŸ¥é“å·²ç»åˆ°è¾¾åˆ†æ”¯çš„ç»“å°¾æ‰€ä»¥ä»–å¯ä»¥å®Œæˆå½“å‰èŠ‚ç‚¹ã€‚ä¸€æ—¦èŠ‚ç‚¹å®Œæˆï¼Œå®ƒéœ€è¦ä¸ºå…„å¼Ÿå§å¦¹æ‰§è¡Œå·¥ä½œå¹¶å‘çˆ¶æ¯å›æº¯ï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨completeUnitOfWorkä¸­å®Œæˆã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; returnFiber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; siblingFiber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sibling&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        nextUnitOfWork &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;siblingFiber &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// If there is a sibling, return it&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// to perform work for this sibling&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; siblingFiber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;returnFiber &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// If there&apos;s no more work in this returnFiber,&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// continue the loop to complete the parent.&lt;/span&gt;
            workInProgress &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; returnFiber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// We&apos;ve reached the root.&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;work completed for &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	åœ¨completeUnitOfWorkä¸­ï¼ŒReactåªå®Œæˆä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„å·¥ä½œï¼Œä»–æ²¡æœ‰å®Œæˆçˆ¶äº²èŠ‚ç‚¹çš„å·¥ä½œã€‚åªæœ‰åœ¨å®Œæˆä»¥å­èŠ‚ç‚¹å¼€å§‹çš„æ‰€æœ‰åˆ†æ”¯åï¼Œæ‰èƒ½å®Œæˆçˆ¶èŠ‚ç‚¹å’Œå›æº¯çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ä»å®ç°ä¸­å¯ä»¥çœ‹å‡ºï¼ŒperformUnitOfWorkå’ŒcompleteUnitOfWorkä¸»è¦ç”¨äºè¿­ä»£ç›®çš„ï¼Œè€Œä¸»è¦æ´»åŠ¨åˆ™åœ¨beginWorkå’ŒcompleteWorkå‡½æ•°ä¸­è¿›è¡Œã€‚ åœ¨æœ¬ç³»åˆ—çš„ä»¥ä¸‹æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ClickCounterç»„ä»¶å’ŒspanèŠ‚ç‚¹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå› ä¸ºReactæ­¥å…¥beginWorkå’ŒcompleteWorkå‡½æ•°ã€‚&lt;/p&gt;
&lt;h3&gt;commit é˜¶æ®µ&lt;/h3&gt;
&lt;p&gt;â€‹	è¿™ä¸ªé˜¶æ®µä»&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L2306&quot;&gt;completeRoot&lt;/a&gt;å¼€å§‹ï¼Œ ä»–æ˜¯reactæ›´æ–°DOMå’Œè°ƒç”¨å‰åç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ã€‚å½“reactè¿›å…¥commité˜¶æ®µæ—¶ï¼Œä¼šæœ‰ä¸¤é¢—æ ‘å’Œeffects listã€‚ç¬¬ä¸€é¢—æ ‘(current)ä»£è¡¨å½“å‰çš„æ¸²æŸ“çŠ¶æ€ã€‚åœ¨&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;é˜¶æ®µä¼šæœ‰ä¸€é¢—alternate treeè¢«ç§°ä½œ&lt;code class=&quot;language-text&quot;&gt;finishedWork&lt;/code&gt;æˆ–&lt;code class=&quot;language-text&quot;&gt;workInProgress&lt;/code&gt;è¡¨ç¤ºå³å°†æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„çŠ¶æ€ã€‚è¿™ä¸ªalternate treeé€šè¿‡childå’ŒsiblingæŒ‡é’ˆç›¸è¿ï¼Œä¸current treeç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ç„¶åï¼Œè¿˜æœ‰ä¸€ä¸ªeffects listâ€”æ¥è‡ª&lt;code class=&quot;language-text&quot;&gt;finishedWork&lt;/code&gt;æ ‘çš„èŠ‚ç‚¹å­é›†å¹¶é€šè¿‡nextEffectæŒ‡é’ˆé“¾æ¥ã€‚è¦è®°ä½effect listæ˜¯æ‰§è¡Œrenderå‡½æ•°çš„ç»“æœã€‚æ¸²æŸ“çš„é‡ç‚¹æ˜¯ç¡®å®šéœ€è¦æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤é‚£äº›èŠ‚ç‚¹ï¼Œä»¥åŠå“ªäº›ç»„ä»¶éœ€è¦è°ƒç”¨å…¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™å°±æ˜¯effect listä½œç”¨ã€‚ä»–æ­£æ˜¯commité˜¶æ®µè¿­ä»£çš„èŠ‚ç‚¹é›†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†debugï¼Œcurrent treeå¯ä»¥é€šè¿‡fiber rootçš„currentå­—æ®µè·å–ã€‚finishedWork treeå¯ä»¥é€šè¿‡current treeä¸­çš„&lt;code class=&quot;language-text&quot;&gt;HostFiber&lt;/code&gt;èŠ‚ç‚¹çš„alternateå­—æ®µè·å–&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€‹	åœ¨commité˜¶æ®µæ‰§è¡Œçš„ä¸»è¦å‡½æ•°æ˜¯&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L523&quot;&gt;commitRoot&lt;/a&gt;ï¼Œä»–çš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æœ‰&lt;code class=&quot;language-text&quot;&gt;Snapshot&lt;/code&gt;effectçš„èŠ‚ç‚¹è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;getSnapshotBeforeUpdate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¹æœ‰&lt;code class=&quot;language-text&quot;&gt;Deletion&lt;/code&gt;effectçš„èŠ‚ç‚¹è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;cWU&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæ‰€æœ‰çš„DOMæ’å…¥æ›´æ–°å’Œåˆ é™¤&lt;/li&gt;
&lt;li&gt;æŠŠfinished treeè½¬ä¸ºcurrent tree&lt;/li&gt;
&lt;li&gt;å¯¹æœ‰&lt;code class=&quot;language-text&quot;&gt;Placement&lt;/code&gt;effectçš„èŠ‚ç‚¹è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;cDM&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¹æœ‰&lt;code class=&quot;language-text&quot;&gt;Update&lt;/code&gt;effectçš„èŠ‚ç‚¹è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;cDU&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹	åœ¨è°ƒç”¨å˜åŠ¨å‰çš„&lt;code class=&quot;language-text&quot;&gt;getSnapshotBeforeUpdate&lt;/code&gt;æ–¹æ³•ä¹‹åï¼Œreactä¼šåœ¨ä¸€æ£µæ ‘ä¸­æäº¤æ‰€æœ‰side-effectsã€‚ä¼šåˆ†æˆä¸¤ä¸ªpassï¼Œä¸€æ˜¯æ‰§è¡Œæ‰€æœ‰DOM(host)æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤å’Œrefå¸è½½ã€‚ç„¶åreactä¼šå°†&lt;code class=&quot;language-text&quot;&gt;finishedWork&lt;/code&gt; treeåˆ†é…ç»™&lt;code class=&quot;language-text&quot;&gt;FiberRoot&lt;/code&gt;å¹¶å°†&lt;code class=&quot;language-text&quot;&gt;workInProgress&lt;/code&gt;treeæ ‡è®°ä¸º&lt;code class=&quot;language-text&quot;&gt;current&lt;/code&gt;treeã€‚è¿™äº›ä¼šåœ¨commité˜¶æ®µçš„ç¬¬ä¸€æ¬¡passåæ‰§è¡Œã€‚æ‰€ä»¥åœ¨&lt;code class=&quot;language-text&quot;&gt;cWU&lt;/code&gt;é˜¶æ®µçš„currentè¿˜æ˜¯æ—§çš„ï¼Œä½†æ˜¯&lt;code class=&quot;language-text&quot;&gt;cDM/cDU&lt;/code&gt;é˜¶æ®µcurrentå°±æ˜¯&lt;code class=&quot;language-text&quot;&gt;finishedWork&lt;/code&gt;treeäº†ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;commitRoot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; finishedWork&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitBeforeMutationLifecycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitAllHostEffects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; finishedWork&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitAllLifeCycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æ¯ä¸€ä¸ªå­å‡½æ•°éƒ½å®ç°äº†ä¸€ä¸ªå¾ªç¯å»éå†effects listå¹¶æ£€æŸ¥effectsçš„ç±»å‹ï¼Œå½“ä»–æ‰¾åˆ°æƒ³è¦çš„ï¼Œå°±ä¼šåº”ç”¨å®ƒã€‚&lt;/p&gt;
&lt;h4&gt;å˜åŒ–å‰çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h4&gt;
&lt;p&gt;â€‹	ä¾‹å¦‚ï¼Œè¿­ä»£effects listå¹¶æ£€æŸ¥æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰&lt;code class=&quot;language-text&quot;&gt;Snapshot&lt;/code&gt;effectçš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//ReactFiberCommitWork.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;commitBeforeMutationLifecycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; effectTag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Snapshot&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alternate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitBeforeMutationLifeCycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        nextEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªclassç»„ä»¶ï¼Œè¿™ä¸ªeffectæ„å‘³ç€è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;getSnapshotBeforeUpdate&lt;/code&gt;ç”Ÿå‘½å‘¨æœŸå‡½æ•°&lt;/p&gt;
&lt;h4&gt;DOMæ›´æ–°&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L376&quot;&gt;commitAllHostEffects&lt;/a&gt;æ˜¯reactæ‰§è¡ŒDOMæ›´æ–°çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å®šä¹‰äº†éœ€è¦è¢«æ‰§è¡Œçš„ç±»å‹å¹¶è§£æï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;commitAllHostEffects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;primaryEffectTag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Placement&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitPlacement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; PlacementAndUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitPlacement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Update&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Deletion&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitDeletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ‰æ„æ€çš„æ˜¯Reactæ˜¯åœ¨&lt;code class=&quot;language-text&quot;&gt;commitDeletion&lt;/code&gt;å‡½æ•°ä¸­ä½œä¸ºåˆ é™¤çš„ä¸€éƒ¨åˆ†è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;cWU&lt;/code&gt;çš„&lt;/p&gt;
&lt;h4&gt;å˜åŒ–åçš„ç”Ÿå‘½å‘¨æœŸ&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L465&quot;&gt;commitAllLifecycles&lt;/a&gt;æ˜¯reactè°ƒç”¨æ‰€æœ‰å‰©ä¸‹çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¦‚&lt;code class=&quot;language-text&quot;&gt;cDU&lt;/code&gt;å’Œ&lt;code class=&quot;language-text&quot;&gt;cDM&lt;/code&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[react 16.7]]></title><description><![CDATA[react 16.7 React DOM 1. Fix performance of   for large numbers of lazily-loaded components. ( @acdlite  in  #14429 ) 2. Clear fields onâ€¦]]></description><link>https://overreacted.io/react 16.7/</link><guid isPermaLink="false">https://overreacted.io/react 16.7/</guid><pubDate>Thu, 20 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;react 16.7&lt;/h1&gt;
&lt;h2&gt;React DOM&lt;/h2&gt;
&lt;h3&gt;1. Fix performance of &lt;code class=&quot;language-text&quot;&gt;React.lazy&lt;/code&gt; for large numbers of lazily-loaded components. (&lt;a href=&quot;https://github.com/acdlite&quot;&gt;@acdlite&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14429&quot;&gt;#14429&lt;/a&gt;)&lt;/h3&gt;
&lt;h3&gt;2. Clear fields on unmount to avoid memory leaks. (&lt;a href=&quot;https://github.com/trueadm&quot;&gt;@trueadm&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14276&quot;&gt;#14276&lt;/a&gt;)&lt;/h3&gt;
&lt;h3&gt;3. Fix bug with SSR and context when mixing &lt;code class=&quot;language-text&quot;&gt;react-dom/server@16.6&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;react@&amp;lt;16.6&lt;/code&gt;. (&lt;a href=&quot;https://github.com/gaearon&quot;&gt;@gaearon&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14291&quot;&gt;#14291&lt;/a&gt;)&lt;/h3&gt;
&lt;h3&gt;4. Fix a performance regression in profiling mode. (&lt;a href=&quot;https://github.com/bvaughn&quot;&gt;@bvaughn&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14383&quot;&gt;#14383&lt;/a&gt;)&lt;/h3&gt;
&lt;h2&gt;Scheduler&lt;/h2&gt;
&lt;h3&gt;1. Post to MessageChannel instead of window. (&lt;a href=&quot;https://github.com/acdlite&quot;&gt;@acdlite&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14234&quot;&gt;#14234&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;â€‹	Scheduleréœ€è¦åœ¨paintä¹‹åè§¦å‘ä¸€ä¸ªtaskï¼ˆä¼šç”¨windowå»postMessageï¼‰ï¼Œåœ¨é˜Ÿåˆ—ä¸ºç©ºä¹‹å‰æ¯ä¸€å¸§éƒ½ä¼šå‘ç”Ÿéƒ½ä¼šè§¦å‘ã€‚è¿™ä¼šå¯¼è‡´å…¶ä»–message event handleræ¯ä¸€å¸§éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå³ä½¿å®ƒä»¬ç«‹å³é€€å‡ºï¼Œè¿™ä¹Ÿä¼šå¢åŠ æ¯å¸§çš„æ˜¾ç€å¼€é”€ã€‚æ‰€ä»¥æ”¹ç”¨MessageChannel&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; MessageChannel &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Use a MessageChannel, if support exists&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MessageChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onmessage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; idleTick&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port2&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. Reduce serialization overhead. (&lt;a href=&quot;https://github.com/developit&quot;&gt;@developit&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14249&quot;&gt;#14249&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨åˆ‡æ¢åˆ°MessageChannelçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯ä¼ é€’äº†â€*â€ã€‚ è¿™å®é™…ä¸Šæœ€ç»ˆä¼šè§¦å‘åºåˆ—åŒ–ã€‚ ä¸ºäº†èŠ‚çœä¸€äº›æ€§èƒ½ï¼Œæ”¹ç”¨undefinedï¼Œå› ä¸ºä¼ é€’ä¸€ä¸ªåƒ0è¿™æ ·çš„æ•°å­—ä»ç„¶ä¼šäº§ç”Ÿåºåˆ—åŒ–å¼€é”€ &lt;/p&gt;
&lt;p&gt;å…·ä½“å¯ä»¥çœ‹&lt;em&gt;&lt;a href=&quot;https://cs.chromium.org/chromium/src/third_party/blink/renderer/bindings/core/v8/script_value.h?type=cs&amp;#x26;g=0&amp;#x26;l=74&quot;&gt;https://cs.chromium.org/chromium/src/third&lt;em&gt;party/blink/renderer/bindings/core/v8/script&lt;/em&gt;value.h?type=cs&amp;#x26;g=0&amp;#x26;l=74&lt;/a&gt;&lt;/em&gt; &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    -  port.postMessage(&amp;#39;*&amp;#39;);
    +  port.postMessage(undefined);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3. Fix fallback to &lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt; in testing environments. (&lt;a href=&quot;https://github.com/bvaughn&quot;&gt;@bvaughn&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14358&quot;&gt;#14358&lt;/a&gt;)&lt;/h3&gt;
&lt;h3&gt;4. Add methods for debugging. (&lt;a href=&quot;https://github.com/mrkev&quot;&gt;@mrkev&lt;/a&gt; in &lt;a href=&quot;https://github.com/facebook/react/pull/14053&quot;&gt;#14053&lt;/a&gt;)&lt;/h3&gt;</content:encoded></item><item><title><![CDATA[react hooks@seb]]></title><description><![CDATA[ç¿»è¯‘è¿™ä¸ª  issue æ³¨å…¥æ¨¡å‹ â€‹	åŸºæœ¬ä¸Šï¼Œäº‰è®ºåˆ†è§£ä¸ºæƒ³è¦äº¤æ¢(swap out)å®ç°é’©å­çš„ä»£ç (the code that implements the hooks)ã€‚è¿™ç±»ä¼¼äºä¸€èˆ¬ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶é—®é¢˜çš„åè½¬(inversion of control problem)ã€‚Reactâ€¦]]></description><link>https://overreacted.io/react hooks@seb/</link><guid isPermaLink="false">https://overreacted.io/react hooks@seb/</guid><pubDate>Tue, 11 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;ç¿»è¯‘è¿™ä¸ª &lt;a href=&quot;https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884&quot;&gt;issue&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ³¨å…¥æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;â€‹	åŸºæœ¬ä¸Šï¼Œäº‰è®ºåˆ†è§£ä¸ºæƒ³è¦äº¤æ¢(swap out)å®ç°é’©å­çš„ä»£ç (the code that implements the hooks)ã€‚è¿™ç±»ä¼¼äºä¸€èˆ¬ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶é—®é¢˜çš„åè½¬(inversion of control problem)ã€‚Reactæ²¡æœ‰è‡ªå·±çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿï¼ˆä¸åŒäºAngularï¼‰ã€‚é€šå¸¸ä»–ä¸éœ€è¦è¿™ä¸ªå› ä¸ºå¤§å¤šæ•°å…¥å£éƒ½æ˜¯pullè€Œä¸æ˜¯pushã€‚å¯¹äºå…¶ä»–ä»£ç ï¼Œæ¨¡å—ç³»ç»Ÿå·²ç»æä¾›äº†è‰¯å¥½çš„ä¾èµ–æ³¨å…¥è¾¹ç•Œï¼Œå¯¹äºæµ‹è¯•ï¼Œæˆ‘ä»¬å€¾å‘äºæ¨èå…¶ä»–æŠ€æœ¯ï¼Œä¾‹å¦‚åœ¨æ¨¡å—ç³»ç»Ÿçº§åˆ«è¿›è¡Œæ¨¡æ‹Ÿï¼ˆä¾‹å¦‚ä½¿ç”¨jestï¼‰&lt;/p&gt;
&lt;p&gt;â€‹	ä¸€äº›ä¾‹å¤–æ˜¯åƒsetState, replaceState, isMounted, findDOMNode, batchedUpdatesç­‰APIï¼Œä¸€ä¸ªå°çš„äº‹å®æ˜¯Reactå·²ç»ä½¿ç”¨ä¾èµ–æ³¨å…¥å°†â€œupdaterâ€æ’å…¥åˆ°Component base classã€‚è¿™æ˜¯æ„é€ å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¯¥ç»„ä»¶å®é™…ä¸Šä¸éœ€è¦åšä»»ä½•äº‹æƒ…ã€‚è¿™å°±æ˜¯è®©Reactåœ¨React ARTæˆ–React Test Rendererç­‰ç›¸åŒç¯å¢ƒä¸­çš„ä¸åŒç‰ˆæœ¬ä¸­å…·æœ‰å¤šç§ä¸åŒç±»å‹çš„æ¸²æŸ“å™¨å®ç°çš„åŸå› ã€‚ è‡ªå®šä¹‰æ¸²æŸ“å™¨å·²ç»åˆ©ç”¨äº†è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReactNoopUpdateQueue &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./ReactNoopUpdateQueue&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;/**
 * Base class helpers for the updating state of a component.
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updater&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// If a component has string refs, we will assign a different object later.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; emptyObject&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// We initialize the default updater but the real one gets injected by the&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// renderer.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updater &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; updater &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; ReactNoopUpdateQueue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	ç†è®ºä¸Šï¼ŒåƒReact-clonesè¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥ä½¿ç”¨updateræ¥æ³¨å…¥ä»–ä»¬çš„å®ç°ã€‚å®è·µä¸­ï¼Œå¤§éƒ¨åˆ†å€¾å‘äºä½¿ç”¨module shimmingæ¥æ›¿æ¢æ•´ä¸ªreactæ¨¡å—ï¼Œå› ä¸ºä»–ä»¬æœ‰æƒè¡¡æˆ–è€…æƒ³è¦å®ç°å…¶ä»–APIï¼ˆä¾‹å¦‚ï¼Œ ç§»é™¤devæ¨¡å¼å†…å®¹æˆ–è€…å°†base classeså’Œå®ç°ç»†èŠ‚åˆå¹¶ï¼‰&lt;/p&gt;
&lt;p&gt;â€‹	è¿™äº›é€‰é¡¹ä»ç„¶ä¿ç•™åœ¨hooksçš„ç¨‹åºä¸­ã€‚hooksçš„å®ç°å®é™…ä¸Šæ²¡æœ‰åœ¨reactåŒ…ä¸­å®ç°ï¼Œå®ƒåªæ˜¯è°ƒç”¨å½“å‰çš„â€œè°ƒåº¦ç¨‹åºâ€ï¼ˆdispatcherï¼‰ã€‚å°±å¦‚æˆ‘ä¸Šé¢è§£é‡Šçš„é‚£æ ·ï¼Œå¯ä»¥æš‚æ—¶è¦†ç›–ä»»ä½•ç»™å®šç‚¹çš„å®ç°ã€‚è¿™å°±æ˜¯reactæ¸²æŸ“å™¨ï¼ˆrenderersï¼‰è®©å¤šä¸ªæ¸²æŸ“å™¨å…±äº«ç›¸åŒAPIã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®©ä¸€ä¸ªé’©å­æµ‹è¯•è°ƒåº¦ç¨‹åºï¼ˆhooks test dispatcherï¼‰åªæ˜¯ä¸ºäº†å•å…ƒæµ‹è¯•hooksã€‚ç›®å‰ä»–æœ‰ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆå¯æ€•çš„åå­—ä¸è¿‡æˆ‘ä»¬å¯ä»¥å¾ˆå®¹å™¨çš„æ”¹å˜è¿™ä¸ªåè¯ï¼Œè¿™ä¸æ˜¯è®¾è®¡çš„ç¼ºé™·ï¼ˆflaw of the designï¼‰ã€‚ç°åœ¨â€œè°ƒåº¦ç¨‹åºï¼ˆdispatcherï¼‰â€å¯ä»¥ç§»åŠ¨åˆ°ç”¨æˆ·ç©ºé—´ä¸­ï¼Œä½†æ˜¯è¿™ä¼šå¢åŠ é¢å¤–çš„å™ªéŸ³ï¼Œè¿™äº›å™ªéŸ³å‡ ä¹ä»æ¥ä¸ä¸å•ä¸ªç»„ä»¶çš„ä½œè€…ç›¸å…³ï¼ˆbut this adds additional noise for something that almost never is relevant to the author of an individual componentï¼‰ï¼Œå°±åƒå¤§å¤šæ•°äººä¸çŸ¥é“Reactä¸­çš„updaterä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨æ›´å¤šçš„é™æ€å‡½æ•°è°ƒç”¨å› ä¸ºä»–ä»¬æ›´é€‚åˆtree-shakingå’Œæ›´å¥½åœ°ä¼˜åŒ–å’Œå†…è”ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å¦ä¸€ä¸ªé—®é¢˜æ˜¯hooksçš„ä¸»å…¥å£åœ¨reactåŒ…ä¸­è€Œä¸æ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œåœ¨æœªæ¥å¾ˆæœ‰å¯èƒ½å…¶ä»–ä»£ç ä¼šç§»é™¤reactåŒ…æ‰€ä»¥hooksä¼šæ˜¯å‰©ä¸‹çš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œæ‰€ä»¥åŒ…ä½“ç§¯ä¸éœ€è¦æ‹…å¿ƒã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯hookså±äºreactä¸‹çš„è€Œä¸æ˜¯æ›´é€šç”¨çš„ã€‚ä¾‹å¦‚ï¼ŒVueæ›¾ç»è€ƒè™‘è¿‡hooks APIã€‚ä½†æ˜¯hooksçš„å…³é”®æ˜¯å…¶åŸå‡½æ•°æˆ‘ä»¬å·²ç»å®šä¹‰å¥½çš„ã€‚è¿™ä¸Vueæœ‰å®Œå…¨ä¸åŒçš„åŸå‡½æ•°ã€‚æˆ‘ä»¬å·²ç»è¿­ä»£äº†æˆ‘ä»¬çš„å‡½æ•°ã€‚å…¶ä»–åº“å¯èƒ½ä¼šæå‡ºç•¥æœ‰ä¸åŒçš„åŸå‡½æ•°ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿‡æ—©åœ°ä½¿è¿™äº›è¿‡äºç¬¼ç»Ÿæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ç¬¬ä¸€æ¬¡è¿­ä»£åœ¨reactåŒ…ä¸Šçš„äº‹å®åªæ˜¯ä¸ºäº†è¯´æ˜è¿™å°±æ˜¯æˆ‘ä»¬å¯¹åŸå‡½æ•°çš„çœ‹æ³•ã€‚å¦‚æœå­˜åœ¨é‡å ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬åœ¨ç¬¬ä¸‰æ–¹å‘½ååŒ…ä¸Šä¸å…¶ä»–åº“è¿›è¡Œæ•´åˆï¼Œå¹¶å°†ååº”çš„é‚£äº›è½¬å‘åˆ°è¯¥åŒ…ã€‚&lt;/p&gt;
&lt;h2&gt;ä¾èµ–æŒç»­è°ƒç”¨é¡ºåº&lt;/h2&gt;
&lt;p&gt;â€‹	è¦æ˜ç¡®çš„æ˜¯ï¼Œæ‰§è¡Œé¡ºåºçš„ä¾èµ–å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ã€‚ é¦–å…ˆæ”¾ç½®useStateæˆ–useEffectæˆ–ç±»ä¼¼çš„ä¸œè¥¿å¹¶ä¸é‡è¦ã€‚Reactæœ‰å¾ˆå¤šä¾èµ–äºæ‰§è¡Œé¡ºåºçš„æ¨¡å¼ï¼Œåªæ˜¯å› ä¸ºåœ¨æ¸²æŸ“ä¸­å…è®¸å˜å¼‚ï¼ˆè¿™ä»ç„¶ä½¿æ¸²æŸ“æœ¬èº«å˜å¾—çº¯å‡€ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Item item&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; header &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Header&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Number &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; items &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Header&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æˆ‘ä¸èƒ½åœ¨æˆ‘çš„ä»£ç ä¸­åªæ”¹å˜childrenå’Œheaderçš„é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;â€‹	hooksä¸å…³å¿ƒä½¿ç”¨çš„é¡ºåºï¼Œå®ƒå…³ç³»æ˜¯å¦æœ‰æŒç»­æ¯æ¬¡éƒ½ä¸€æ ·çš„é¡ºåºã€‚è¿™ä¸è°ƒç”¨ä¹‹é—´éšå«çš„ä¾èµ–æ€§éå¸¸ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;â€‹	æœ€å¥½ä¸è¦ä¾èµ–æŒä¹…ç§©åº - æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯å¹³ç­‰çš„ã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€äº›æƒè¡¡ã€‚ ä¾‹å¦‚ã€‚ è¯­æ³•å™ªéŸ³æˆ–å…¶ä»–ä»¤äººå›°æƒ‘çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	Some think that it is worth the cost for puritism reasons alone. However, some also have practical concerns.&lt;/p&gt;
&lt;h2&gt;APIè®¾è®¡&lt;/h2&gt;
&lt;h3&gt;useReducer&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reset&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;increment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;decrement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// A reducer must always return a valid state.&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Alternatively you can throw an error if an invalid action is dispatched.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;initialCount&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;reducer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; initialCount&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      Count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reset&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        Reset
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;increment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;decrement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªä¼šæ›¿æ¢Reduxå—ï¼Ÿè¿™å›åŠ é‡å­¦ä¹ fluxçš„è´Ÿæ‹…å—ï¼Ÿä¸€èˆ¬æ¥è¯´æ¯”èµ·å¾ˆå¤šfluxæ¡†æ¶ï¼ŒReduceræ˜¯ä¸€ä¸ªæ›´ç‹­éš˜çš„ç”¨ä¾‹ï¼ŒReduceréå¸¸ç®€å•ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨å­¦ä¹ Vueï¼ŒReasonï¼ŒElmç­‰æ¡†æ¶/è¯­è¨€ï¼Œè°ƒåº¦å’Œé›†ä¸­é€»è¾‘ä»¥åœ¨æ›´é«˜çº§åˆ«çš„çŠ¶æ€ä¹‹é—´è½¬æ¢çš„è¿™ç§ä¸€èˆ¬æ¨¡å¼ä¼¼ä¹å–å¾—äº†å·¨å¤§æˆåŠŸã€‚å®ƒè¿˜è§£å†³äº†Reactä¸­å¸¦æœ‰å›è°ƒçš„è®¸å¤šæ€ªç™–ï¼Œä¸ºå¤æ‚çš„çŠ¶æ€è½¬æ¢å¸¦æ¥äº†æ›´å¤šç›´è§‚çš„è§£å†³æ–¹æ¡ˆã€‚ç‰¹åˆ«æ˜¯åœ¨å¹¶è¡Œï¼ˆconcurrentï¼‰çš„ä¸–ç•Œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä»£ç ä½“ç§¯ä¸Šçœ‹ï¼Œä»–ä¸ä¼šå¢åŠ ä»»ä½•éå½“å‰å¿…é¡»çš„ä»£ç ï¼Œä»æ¦‚å¿µä¸Šï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„æ¦‚å¿µï¼Œå› ä¸ºç›¸åŒçš„æ¨¡å¼ä¸æ–­ä»¥å„ç§å½¢å¼å‡ºç°åœ¨å„å¤„ã€‚ æœ€å¥½æœ‰ä¸€ä¸ªä¸­å¤®APIæ¥ç®¡ç†å®ƒã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘è®¤ä¸ºæ¯”èµ·useStateï¼ŒuseReduceræ˜¯æ›´åŠ æ ¸å¿ƒçš„APIã€‚ä½†æ˜¯useStateä¾ç„¶å¾ˆæ£’å› ä¸ºå¯¹äºç®€å•çš„ç”¨ä¾‹æ¥è¯´å®ƒéå¸¸ç®€æ´è€Œä¸”ç®€æ˜“è§£é‡Šï¼Œä¸è¿‡å¤§å®¶åº”è¯¥å°½æ—©ç ”ç©¶useReduceræˆ–å…¶ä»–ç›¸ä¼¼çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¹Ÿæ²¡æœ‰åšReduxå’Œå…¶ä»–Fluxæ¡†æ¶æ‰€åšçš„å¾ˆå¤šäº‹æƒ…ã€‚é€šå¸¸æˆ‘è®¤ä¸ºä½ ä¸ä¼šéœ€è¦å®ƒï¼Œæ‰€ä»¥å®ƒå¯èƒ½ä¸åƒç°åœ¨é‚£æ ·æ™®éå­˜åœ¨ï¼Œä½†å®ƒä»ç„¶å­˜åœ¨ã€‚&lt;/p&gt;
&lt;h3&gt;Context Provider&lt;/h3&gt;
&lt;h3&gt;useEffect&lt;/h3&gt;
&lt;p&gt;ç›®å‰æœ€å¥‡æ€ªçš„Hookæ˜¯&lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt;ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œé¢„è®¡è¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€éš¾ä½¿ç”¨çš„Hookï¼Œå› ä¸ºå®ƒæ­£åœ¨ä½¿ç”¨å‘½ä»¤å¼ä»£ç ï¼ˆinteroping with imperative codeï¼‰ã€‚å‘½ä»¤å¼ä»£ç å¾ˆéš¾ç®¡ç†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯•å›¾ä¿æŒå£°æ˜å¼ä»£ç ã€‚ä½†æ˜¯ï¼Œä»å£°æ˜å¼å˜ä¸ºå‘½ä»¤å¼å¾ˆéš¾ï¼Œå› ä¸ºå£°æ˜å¼å¯ä»¥å¤„ç†æ›´å¤šä¸åŒç±»å‹çš„çŠ¶æ€å’Œæ¯è¡Œä»£ç çš„è½¬æ¢ã€‚ å®ç°æ•ˆæœæ—¶ï¼Œç†æƒ³æƒ…å†µä¸‹ä¹Ÿåº”å¤„ç†æ‰€æœ‰è¿™äº›æƒ…å†µã€‚ è¿™é‡Œçš„éƒ¨åˆ†ç›®æ ‡æ˜¯é¼“åŠ±å¤„ç†æ›´å¤šæƒ…å†µã€‚ å¦‚æœè¿™æ ·åšï¼Œé‚£ä¹ˆä¸€äº›æ€ªç™–æ˜¯å¯ä»¥çš„ã€‚&lt;/p&gt;</content:encoded></item><item><title><![CDATA[learning A Cartoon to Fiber]]></title><description><![CDATA[è¿™é‡Œæˆ‘è¿˜æ²¡å†™å®Œ stack reconcilerçš„ç¼ºç‚¹ â€‹	åœ¨æˆ‘ä»¬æ‰§è¡Œupdateæ“ä½œä¹‹å‰æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªåœ¨åˆå§‹renderæ—¶å·²ç»æ„é€ å¥½çš„fiberæ ‘ï¼Œreactä¹Ÿä¼šå¼€å§‹work-in-progressæ ‘å¹¶æ·»åŠ ç¬¬ä¸€ä¸ªfiberèŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³å½“æˆ‘ä»¬è®¡ç®—å˜åŠ¨æ—¶ç›´æ¥ä¿®æ”¹domâ€¦]]></description><link>https://overreacted.io/learning A Cartoon to Fiber/</link><guid isPermaLink="false">https://overreacted.io/learning A Cartoon to Fiber/</guid><pubDate>Sun, 11 Nov 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;è¿™é‡Œæˆ‘è¿˜æ²¡å†™å®Œ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110201732613.png&quot; alt=&quot;image-20181110201732613&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110202214457.png&quot; alt=&quot;image-20181110202214457&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/h5/1tnmsg713pldfgpyxh4c41wm0m7_pl/T/abnerworks.Typora/image-20181110203945805.png&quot; alt=&quot;image-20181110203945805&quot;&gt;&lt;/p&gt;
&lt;h2&gt;stack reconcilerçš„ç¼ºç‚¹&lt;/h2&gt;
&lt;p&gt;â€‹	åœ¨æˆ‘ä»¬æ‰§è¡Œupdateæ“ä½œä¹‹å‰æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªåœ¨åˆå§‹renderæ—¶å·²ç»æ„é€ å¥½çš„fiberæ ‘ï¼Œreactä¹Ÿä¼šå¼€å§‹work-in-progressæ ‘å¹¶æ·»åŠ ç¬¬ä¸€ä¸ªfiberèŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³å½“æˆ‘ä»¬è®¡ç®—å˜åŠ¨æ—¶ç›´æ¥ä¿®æ”¹domï¼Œè¿™ä¸ªè·Ÿstack reconcilerä¸ä¸€æ ·ï¼Œstack reconcileråœ¨å¾€ä¸‹èµ°æ”¹å˜å®ä¾‹æ—¶åŒæ—¶æ”¹åŠ¨å½“å‰çš„domèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ä¾‹å¦‚åœ¨å°†å®ä¾‹2å˜æˆ4æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šæ”¹åŠ¨dom nodeä»2åˆ°4åœ¨reactè®¡ç®—ç¬¬ä¸‰ä¸ªå®ä¾‹åº”è¯¥ä»3å˜åˆ°9å‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/h5/1tnmsg713pldfgpyxh4c41wm0m7_pl/T/abnerworks.Typora/image-20181110204749728.png&quot; alt=&quot;image-20181110204749728&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·å­æ˜¯å¯è¡Œçš„å¦‚æœä½ ä¸€æ¬¡æ€§åŒæ­¥åœ°å®Œæˆæ‰€æœ‰äº‹æƒ…ã€‚å¦‚æœä½ éœ€è¦åœ¨ä¸¤ä¸ªå®ä¾‹é—´æ‰“æ–­æ—¶ï¼Œæµè§ˆå™¨éœ€è¦æ—¶é—´paintå’Œlayoutï¼Œä½†æ˜¯åªæœ‰2å˜æˆ4è€Œ3æ²¡æœ‰å˜æˆ9ï¼Œè¿™æ ·ä½ çš„uiå°±ä¼šå˜å¾—ä¸è¿ç»­ã€‚&lt;/p&gt;
&lt;h2&gt;fiber phases&lt;/h2&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œreactåªä¼šæ„å»ºfiber treeå’Œwork-in-progress treeå’Œå˜åŠ¨åˆ—è¡¨ï¼ˆå¯ä¸­æ–­ï¼‰&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒé˜¶æ®µï¼Œå°†è¿™äº›å˜åŠ¨ä½œç”¨åˆ°domä¸Šï¼ˆä¸å¯ä¸­æ–­ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/h5/1tnmsg713pldfgpyxh4c41wm0m7_pl/T/abnerworks.Typora/image-20181110210012223.png&quot; alt=&quot;image-20181110205919129&quot;&gt;&lt;/p&gt;
&lt;h2&gt;é˜¶æ®µ1&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘äº†setState&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110210205135.png&quot; alt=&quot;image-20181110210205135&quot;&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;
&lt;p&gt;å½“setStateè¢«è°ƒç”¨æ—¶ï¼Œreactä¼šæ·»åŠ Listç»„ä»¶ä¸€ç³»åˆ—æ›´æ–°æ·»åŠ åˆ°æ›´æ–°é˜Ÿåˆ—ä¸­ï¼Œç„¶åreactä¼šå¼€å§‹è°ƒåº¦è¿™äº›å·¥ä½œ&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110210528429.png&quot; alt=&quot;image-20181110210528429&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨request idle callbackå»å»¶è¿Ÿå®Œæˆè¿™äº›å·¥ä½œ &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110210741530.png&quot; alt=&quot;image-20181110210741530&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“ä¸»çº¿ç¨‹æœ‰ç©ºé—²æ—¶é—´æ—¶ä¼šæŠŠå…·ä½“å‰©ä½™æ—¶é—´ç»™reactï¼Œå…·ä½“å‡ æ¯«ç§’åˆ°å‡ åæ¯«ç§’ï¼ˆå½“æœ€è¿‘çš„å°†æ¥æ²¡æœ‰frame scheduledæ—¶ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110211003501.png&quot; alt=&quot;image-20181110211003501&quot;&gt;&lt;/p&gt;
&lt;p&gt;â€‹	è¿™æ ·reactå¯ä»¥ä½¿ç”¨è¿™äº›å‰©ä½™æ—¶é—´å¤„ç†æ›´æ–°å¹¶å½“å…¶ä»–å·¥ä½œéœ€è¦å¤„ç†æ—¶å°†æ—¶é—´è¿˜ç»™ä¸»çº¿ç¨‹ã€‚è¿™æ ·çš„æ“ä½œéœ€è¦è·Ÿè¸ªä¸¤ä¸ªæ—¶é—´ï¼Œnext unit of work that it needs to work on å’Œ ä¸»çº¿ç¨‹ç»™ä¸çš„å‰©ä½™æ—¶é—´&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110211302791.png&quot; alt=&quot;image-20181110211302791&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»currentå¤åˆ¶HostRootçš„æ•°æ®åˆ°workInProgress tree å¹¶æ·»åŠ ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å„¿å­ï¼ˆListï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110211949517.png&quot; alt=&quot;image-20181110211949517&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºListæœ¬èº«æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥å°†Listå¤åˆ¶åˆ°workInProgress treeã€‚å¹¶ä¸”Listæœ‰æ›´æ–°é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¹Ÿä¼šå¤åˆ¶update Queueã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110212258539.png&quot; alt=&quot;image-20181110212258539&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰€ä»¥List fiber is going to be returned as the next unit of work&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110212347964.png&quot; alt=&quot;image-20181110212347964&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;React ä¼šæ£€æŸ¥deadlineæ˜¯å¦åˆ°æ¥ã€‚å› ä¸ºè¿˜æœ‰å‰©ä½™çš„æ—¶é—´ï¼Œreactä¼šç»§ç»­å¤„ç†List&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110212645386.png&quot; alt=&quot;image-20181110212645386&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºListæœ‰æ›´æ–°é˜Ÿåˆ—ï¼Œæ‰€ä»¥reactä¼šå¤„ç†è¿™äº›æ›´æ–°ï¼Œä»–ä¼šè°ƒç”¨updaterå‡½æ•°ï¼Œä¸”ä¼ å¯¹è±¡çš„setStateä»¥åçš„æŸä¸ªç‰ˆæœ¬è¢«ç§»é™¤&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110212849733.png&quot; alt=&quot;image-20181110212849733&quot;&gt;å¹¶ç»“æŸå¤„ç†æ›´æ–°é˜Ÿåˆ—ï¼Œfiberä¼šæ ‡è®°ä¸€ä¸ªtagè¡¨ç¤ºä»–ä¼šä¿®æ”¹domæ ‘&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110213110874.png&quot; alt=&quot;image-20181110213110874&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ç»§ç»­å¾€ä¸‹å¤„ç†å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“Listçš„childrenï¼Œæ‰€ä»¥reactä¼šåœ¨Listå®ä¾‹è®¾ç½®propså’Œstateå¹¶è°ƒç”¨renderï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ã€‚reactä¼šéå†è¿™äº›å…ƒç´ å»åˆ¤æ–­åœ¨current treeä¸­æ˜¯å¦æœ‰å¯ä»¥é‡ç”¨çš„fiberã€‚å¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥å¤åˆ¶&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110213813900.png&quot; alt=&quot;image-20181110213813900&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110213944644.png&quot; alt=&quot;image-20181110213944644&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶åä¼šè¿”å›Listçš„ç¬¬ä¸€ä¸ªchild buttonä½œä¸ºä¸‹ä¸€ä¸ªunit of work, ç„¶åreactä¼šå›åˆ°work loopå¹¶æ£€æŸ¥deadlineã€‚&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110214543420.png&quot; alt=&quot;image-20181110214543420&quot;&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110214728829.png&quot; alt=&quot;image-20181110214728829&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™ç”¨æˆ·æƒ³æäº‹æƒ…ï¼Œç‚¹å‡»æ”¾å¤§å­—ä½“æŒ‰é’®å»æ”¹å˜webå­—ä½“å¤§å°&lt;img src=&quot;/var/folders/h5/1tnmsg713pldfgpyxh4c41wm0m7_pl/T/abnerworks.Typora/image-20181110214856489.png&quot; alt=&quot;image-20181110214856489&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™æ ·ä¼šå¯¼è‡´ç»™é˜Ÿåˆ—ä¸­çš„ä¸€äº›ä¸œè¥¿æ·»åŠ äº†ä¸€ä¸ªå›è°ƒï¼Œä¸»çº¿ç¨‹éœ€è¦å»å…³å¿ƒçš„ï¼Œä½†æ˜¯ä¸æ˜¯é©¬ä¸Šå› ä¸ºreactä»ç„¶æœ‰æ—¶é—´ç»§ç»­å¤„ç†next unit of work â€” buttonã€‚buttonæ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªé‡åˆ°çš„æ²¡æœ‰å­©å­çš„å…ƒç´ ï¼Œæ‰€ä»¥ä»–ä¸ä¼šåˆ›å»ºæ–°çš„å·¥ä½œã€‚æ‰€ä»¥reactå¯ä»¥å®Œæˆè¿™ä¸ªå•ä½çš„å·¥ä½œï¼Œè¿™æ„å‘³ç€æ¯”è¾ƒæ–°æ—§å…ƒç´ æŸ¥çœ‹æ˜¯å¦æœ‰å˜åŠ¨ï¼Œå¦‚æœæœ‰å˜åŠ¨éœ€è¦å˜åŠ¨domåˆ™ä¼šæ ‡è®°ã€‚ç„¶åå› ä¸ºbuttonæ²¡æœ‰å­©å­ï¼Œæ‰€ä»¥ä¼šè¿”å›é‚»å±…ä½œä¸ºä¸‹ä¸€ä¸ªå•ä½çš„å·¥ä½œ&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110215513582.png&quot; alt=&quot;image-20181110215513582&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;reactä¼šç»“æŸè¿™ä¸ªå•å…ƒçš„å·¥ä½œå¹¶å›åˆ°work loopä¸­æ£€æŸ¥deadline&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110215657530.png&quot; alt=&quot;image-20181110215657530&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;itemä¸­æœ‰sCUï¼Œå¹¶ä¸”å› ä¸ºsCUè¿”å›falseæ‰€ä»¥item1ä¸éœ€è¦å¯¹domè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰“æ ‡ç­¾ã€‚ç„¶åé‚»å±…ä½œä¸ºä¸‹ä¸€ä¸ªå•å…ƒçš„å·¥ä½œã€‚åŒæ ·åœ°ï¼Œreactå›åˆ°work loopæ£€æŸ¥deadlineå¹¶å›æ¥&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110215823086.png&quot; alt=&quot;image-20181110215823086&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒä¸ªitemçš„sCUè¿”å›trueï¼Œæ‰€ä»¥ä¼šè¢«æ ‡è®°ä¸ºæœ‰æ›´å˜ï¼Œç„¶åä»–çš„divä¼šè¢«å¤åˆ¶è¿‡æ¥ï¼Œå¹¶ä¸”å°†divè¿”å›ä½œä¸ºä¸‹ä¸€ä¸ªå•å…ƒçš„å·¥ä½œ
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110220630861.png&quot; alt=&quot;image-20181110220630861&quot;&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110220704324.png&quot; alt=&quot;image-20181110220704324&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ol start=&quot;16&quot;&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸¢ä¸¢æ—¶é—´æ‰€ä»¥æˆ‘ä»¬å‡†å¤‡å¤„ç†è¿™ä¸ªdivï¼Œå› ä¸ºè¿™ä¸ªdivæ²¡æœ‰childrenæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®Œæˆå®ƒï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªdivçš„å†…å®¹å˜æ›´äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™ä»–æ‰“ä¸Šæ ‡è®°
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110222423364.png&quot; alt=&quot;image-20181110222222665&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºå½“å‰æ²¡æœ‰é‚»å±…ä¹Ÿæ²¡æœ‰childrenï¼Œæ²¡æœ‰ä¸‹ä¸ªå•å…ƒçš„å·¥ä½œï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ä»–çˆ¶äº²çš„completeï¼Œå¹¶ä¸”è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å°†å˜åŠ¨æ·»åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºä»–æœ‰tagä¸”å®Œæˆäº†(completed)ã€‚
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110224035848.png&quot; alt=&quot;image-20181110224035848&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™itemä¹Ÿå®Œæˆäº†(complated)å¹¶ä¸”ä»–ä¹Ÿæœ‰ä¸€ä¸ªtagã€‚so itâ€™s going to move itself up to itâ€™s going to start creating this list of changes on its parent. It merge its own list of changes into the parents effect list&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;itemä¼šå°†divçš„å˜åŠ¨æ”¾åˆ°effect listçš„ç¬¬ä¸€ä¸ªï¼Œç„¶åå°†è‡ªå·±æ”¾åˆ°effect listçš„æœ«å°¾
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110224526544.png&quot; alt=&quot;image-20181110224526544&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒä¸ªitem complete å¹¶è¿”å›é‚»å±…ä½œä¸ºä¸‹ä¸€ä¸ªå•å…ƒçš„å·¥ä½œ&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110224637609.png&quot; alt=&quot;image-20181110224637609&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿”å›work loopï¼Œreactå‘ç°deadlineå·²ç»åˆ°äº†ã€‚æ‰€ä»¥reactä¼šé‡Šæ”¾èµ„æºå¹¶è®©ä¸»çº¿ç¨‹å¤„ç†å…¶ä»–ä»»åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110224810666.png&quot; alt=&quot;image-20181110224810666&quot;&gt;&lt;/p&gt;
&lt;p&gt;reactä»ç„¶éœ€è¦ç»§ç»­å®Œæˆä»»åŠ¡ï¼Œæ‰€ä»¥ä½¿ç”¨rICè®©ä¸»çº¿ç¨‹å®Œæˆå·¥ä½œåç»§ç»­è°ƒç”¨react&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110224939741.png&quot; alt=&quot;image-20181110224939741&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åä¸»çº¿ç¨‹ä¼šå»å¤„ç†ç­‰å¾…ä¸­çš„callbackï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯layout&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110225030973.png&quot; alt=&quot;image-20181110225030973&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æ³¨æ„åˆ°nothing in the content of our react app is changed even though react note says going to need to change two to four åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ï¼Œè€Œä¸æ˜¯ç°åœ¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ol start=&quot;21&quot;&gt;
&lt;li&gt;
&lt;p&gt;main thread å¤„ç†å®Œå…¶ä»–äº‹æƒ…ä¼šç»§ç»­è°ƒç”¨reactï¼Œæœ€åä¸¤ä¸ªå•å…ƒå·¥ä½œå’Œç¬¬äºŒä¸ªitemä¸€æ ·&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110225617532.png&quot; alt=&quot;image-20181110225617532&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110225632116.png&quot; alt=&quot;image-20181110225632116&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å³å®Œæˆäº†Listä¸‹é¢çš„æ‰€æœ‰å•å…ƒå·¥ä½œï¼Œæ‰€ä»¥Listå¯ä»¥è°ƒç”¨completeï¼Œå¹¶å°†è‡ªå·±å’Œå­©å­çš„æ›´å˜æ”¾åˆ°effect listä¸­ï¼Œç„¶åHostRootä¹Ÿå®Œæˆäº†
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110230128716.png&quot; alt=&quot;image-20181110225715325&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110225807413.png&quot; alt=&quot;image-20181110225807413&quot;&gt;&lt;/p&gt;
&lt;ol start=&quot;22&quot;&gt;
&lt;li&gt;reactä¼šå°†work-in-progress treeè®¾æˆpending commitï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªé˜¶æ®µç»“æŸäº†ã€‚æˆ‘ä»¬æ›´æ–°äº†work-in-progress treeå’ŒæŒ‡å‡ºäº†å˜åŠ¨åˆ—è¡¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;é˜¶æ®µ2&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;react ä¼šæ£€æŸ¥deadlineåˆ¤æ–­æ˜¯å¦æœ‰æ—¶é—´ç«‹åˆ»æ‰§è¡Œcommitï¼Œå¦‚æœä¸å¤Ÿåˆ™åœ¨rICåç¬¬ä¸€æ—¶é—´commitè¿™ä¸ªpending commit&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110230504330.png&quot; alt=&quot;image-20181110230504330&quot;&gt;&lt;/li&gt;
&lt;li&gt;reactä¼šéå†effect listå¹¶åº”è¯¥æ›´å˜åˆ°domä¸Šï¼Œä»ç¬¬ä¸€ä¸ªfiberå¼€å§‹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110230821602.png&quot; alt=&quot;image-20181110230821602&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110230855909.png&quot; alt=&quot;image-20181110230855909&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110230913246.png&quot; alt=&quot;image-20181110230913246&quot;&gt;
itemæ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä½¿ç”¨refï¼Œä¸è¿‡å¦‚æœæˆ‘ä»¬åœ¨itemä¸­æœ‰ref will be detached now and then it would be reattached later
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110231153619.png&quot; alt=&quot;image-20181110231153619&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110231121156.png&quot; alt=&quot;image-20181110231121156&quot;&gt;
ç°åœ¨æ‰€æœ‰å˜åŠ¨éƒ½åœ¨ç¬¬ä¸€é˜¶æ®µè®¡ç®—å®Œæ¯•å¹¶commitåˆ°domæ ‘ã€‚è¿™æ„å‘³ç€work-in-progress tree is actually a more up-to-date version of state of the app than the current treeï¼Œæ‰€ä»¥reactéœ€è¦ä¿®å¤current treeã€‚ä»–ä¼šåˆ‡æ¢æŒ‡é’ˆï¼Œæ‰€ä»¥å½“å‰æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬åˆšæ„å»ºçš„work-in-pregress tree
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110231429089.png&quot; alt=&quot;image-20181110231429089&quot;&gt;
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110231630674.png&quot; alt=&quot;image-20181110231630674&quot;&gt;
è¿™æ„å‘³ç€reactå¯ä»¥åœ¨work-in-progress treeä¸­é‡ç”¨æ—§å¯¹è±¡ï¼Œåªéœ€è¦åœ¨ä¸‹æ¬¡æ„å»ºä¸­work-in-progress treeå¤åˆ¶key valueã€‚è¿™å«double bufferingï¼Œå¯ä»¥åœ¨å†…å­˜åˆ†é…å’Œgcä¸­èŠ‚çœæ—¶é—´ï¼Œç°åœ¨reactå®Œæˆäº†è¿™æ¬¡çš„commitï¼Œå¹¶æ‰§è¡Œå‰©ä¸‹çš„lifecycle hookså’Œæ›´æ–°ä»»ä½•refså¹¶å¤„ç†error boundaries
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110232043775.png&quot; alt=&quot;image-20181110232043775&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ä¼˜å…ˆçº§&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;Synchronous&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;same as stack rec&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;Task&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;before next tick&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;Animation&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;before next frame&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;token string&quot;&gt;&quot;rIC&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        	&lt;span class=&quot;token string&quot;&gt;&quot;High&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pretty soon&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;Low&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;å¦‚æ•°æ®è·å–ï¼Œå¯¹100or200msä¸æ•æ„Ÿ&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;token string&quot;&gt;&quot;Offscreen&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;prep for display/scroll&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå°½ç®¡ç°åœ¨å·²ç»å¼€å§‹äº†ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110232753533.png&quot; alt=&quot;image-20181110232753533&quot;&gt;&lt;/p&gt;
&lt;p&gt;å›åˆ°ä¹‹å‰æˆ‘ä»¬æäº‹æƒ…çš„åœ°æ–¹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç´§æ€¥çš„font resize button
&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181110233032279.png&quot; alt=&quot;image-20181110233032279&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·ç‚¹å‡»åä¼šæ”¾ç½®ä¸€ä¸ªcallbackåˆ°ä¸»çº¿ç¨‹å¤„ç†é˜Ÿåˆ—ä¸­&lt;/p&gt;
&lt;h2&gt;lifecycle hook during the phase&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181111143014786.png&quot; alt=&quot;image-20181111143014786&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181111143107194.png&quot; alt=&quot;image-20181111143107194&quot;&gt;&lt;/p&gt;
&lt;h2&gt;starvation&lt;/h2&gt;
&lt;p&gt;reusing work where it can. So if it had a low priority work that was done and the high priority work didnâ€™t touch that part of the tree then they can reuse that work.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/xuzhanhong1/Documents/image-20181111143219524.png&quot; alt=&quot;image-20181111143219524&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ç›¸å…³èµ„æ–™&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/facebook/react/blob/master/packages/shared/ReactSideEffectTags.js&quot;&gt;effectTag&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/react/blob/0154a79fedef38a824a837c535bc853013dd4588/packages/react-scheduler/src/ReactScheduler.js#L25-L31&quot;&gt;react custom rIC&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Promise]]></title><description><![CDATA[Promise è§è¯†äº†ä¸€é“é¢è¯•é¢˜ï¼Œé‡æ¸©ä¸€ä¸‹Promiseã€‚ é¢˜ç›® åˆ†æ â€‹	ä¹çœ‹é¢˜ç›®æ²¡ä»€ä¹ˆå›°éš¾ï¼Œè¦å®ç°ä¹Ÿå¯ä»¥å¼ºè¡Œç”¨timeoutå»¶è¿Ÿajax2çš„è°ƒç”¨ã€‚ä½†æ˜¯é¢˜ç›®è‚¯å®šä¸æ˜¯åšå®Œå°±å¥½äº†ï¼Œå°±åœ¨æƒ³mergePromiseèƒ½å¦å†™æˆèƒ½å®ç°fcâ€¦]]></description><link>https://overreacted.io/Promise/</link><guid isPermaLink="false">https://overreacted.io/Promise/</guid><pubDate>Wed, 25 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Promise&lt;/h1&gt;
&lt;p&gt;è§è¯†äº†ä¸€é“é¢è¯•é¢˜ï¼Œé‡æ¸©ä¸€ä¸‹Promiseã€‚&lt;/p&gt;
&lt;h2&gt;é¢˜ç›®&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ms &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ajax1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ajax2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ajax3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function-variable function&quot;&gt;mergePromise&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ajaxArray &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//å¡«è¿™é‡Œ&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;mergePromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;ajax1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ajax2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ajax3&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;done&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// åˆ†åˆ«è¾“å‡º&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 1&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 2&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 3&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// done&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// [1, 2, 3]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;åˆ†æ&lt;/h2&gt;
&lt;p&gt;â€‹	ä¹çœ‹é¢˜ç›®æ²¡ä»€ä¹ˆå›°éš¾ï¼Œè¦å®ç°ä¹Ÿå¯ä»¥å¼ºè¡Œç”¨timeoutå»¶è¿Ÿajax2çš„è°ƒç”¨ã€‚ä½†æ˜¯é¢˜ç›®è‚¯å®šä¸æ˜¯åšå®Œå°±å¥½äº†ï¼Œå°±åœ¨æƒ³mergePromiseèƒ½å¦å†™æˆèƒ½å®ç°fcï¼Œè€Œä¸æ˜¯ä»…ä»…å®Œæˆè¿™ä¸€é¢˜ã€‚éš¾ç‚¹å°±åœ¨äºå¦‚ä½•è§£å†³forEachæˆ–è€…ä½¿ç”¨reduceåè¿˜èƒ½ä¿æŒthençš„çŠ¶æ€&lt;/p&gt;
&lt;h2&gt;æˆ‘ç†è§£çš„Promise&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰€è°“&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;  ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»&lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;å˜ä¸º&lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt;å’Œä»&lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;å˜ä¸º&lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt;ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; æ ¸å¿ƒæ˜¯è¦ç†è§£å®¹å™¨ä¸çŠ¶æ€æ”¹å˜åå°±ä¸ä¼šå†å˜çš„çŠ¶æ€ã€‚æ‰€ä»¥æ ¹æ®è¿™ä¸ªç‰¹æ€§å¯ä»¥æ‹“å±•forEachåªèƒ½åŒæ­¥æ‰§è¡Œçš„å¼±ç‚¹ï¼Œé€šè¿‡forEachå°†ajaxArrayæ‹¼åœ¨ä¸€æ¡Promiseé“¾ä¸­ã€‚&lt;/p&gt;
&lt;h2&gt;Promiseå­¦ä¹ &lt;/h2&gt;
&lt;h3&gt;ä¸€ä¸ªç®€å•çš„å»¶æ—¶å™¨&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;PromiseåµŒå¥—&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; p1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fail&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; p2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

p2
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Error: fail&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢ä»£ç ä¸­ï¼Œp1æ˜¯ä¸€ä¸ª Promiseï¼Œ3 ç§’ä¹‹åå˜ä¸ºrejectedã€‚p2çš„çŠ¶æ€åœ¨ 1 ç§’ä¹‹åæ”¹å˜ï¼Œresolveæ–¹æ³•è¿”å›çš„æ˜¯p1ã€‚ç”±äºp2è¿”å›çš„æ˜¯å¦ä¸€ä¸ª Promiseï¼Œå¯¼è‡´p2è‡ªå·±çš„çŠ¶æ€æ— æ•ˆäº†ï¼Œç”±p1çš„çŠ¶æ€å†³å®šp2çš„çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œåé¢çš„thenè¯­å¥éƒ½å˜æˆé’ˆå¯¹åè€…ï¼ˆp1ï¼‰ã€‚åˆè¿‡äº† 2 ç§’ï¼Œp1å˜ä¸ºrejectedï¼Œå¯¼è‡´è§¦å‘catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚&lt;/p&gt;
&lt;h3&gt;Promise.resolve()&lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œ&lt;code class=&quot;language-text&quot;&gt;Promise.resolve&lt;/code&gt;æ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.resolve&lt;/code&gt;ç­‰ä»·äºä¸‹é¢çš„å†™æ³•ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ç­‰ä»·äº&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;ç­”æ¡ˆ&lt;/h2&gt;
&lt;p&gt;æ„å»ºé¡ºåºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„åŸºæœ¬å—æ˜¯&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; sequence &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
sequence &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sequence&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;//deal item)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function-variable function&quot;&gt;mergePromise&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ajaxArray &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//èµ·å§‹çš„promise&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; sequence &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// å­˜æ”¾æ•°ç»„ä¸­æ¯ä¸€ä¸ªpromiseçš„ç»“æœ&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ret &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//ä¸ºäº†å®ç°Promiseé“¾çš„å»¶ç»­ï¼Œè¿™é‡Œå¿…é¡»è¿”å›ä¸€ä¸ªpromiseï¼Œè€Œä¸”è¿”å›å€¼æ˜¯ret&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;reslove&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; 
        ajaxArray&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        	&lt;span class=&quot;token comment&quot;&gt;//è¿™é‡Œçš„forEachæ˜¯åŒæ­¥æ‰§è¡Œçš„&lt;/span&gt;
            sequence &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sequence&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                ret&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt;ajaxArray&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;reslove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

            console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;!!!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sequence&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;mergePromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;ajax1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ajax2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ajax3&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;done&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[state & props update]]></title><description><![CDATA[Demo: https://stackblitz.com/edit/react-jwqn64 å½“æˆ‘ä»¬ç‚¹å‡»buttonæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° completeWork ï¼š æ›´æ–° ä¸­çš„count state è°ƒç”¨ æ–¹æ³•å»å¾—åˆ°childrenåˆ—è¡¨å¹¶æ‰§è¡Œæ¯”è¾ƒ æ›´æ–° å…ƒç´ çš„propsâ€¦]]></description><link>https://overreacted.io/state &amp; props update/</link><guid isPermaLink="false">https://overreacted.io/state &amp; props update/</guid><pubDate>Sun, 07 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Demo:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackblitz.com/edit/react-jwqn64&quot;&gt;https://stackblitz.com/edit/react-jwqn64&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleClick &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleClick&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;componentDidUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleClick&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Update counter&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“æˆ‘ä»¬ç‚¹å‡»buttonæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberCompleteWork.js#L532&quot;&gt;&lt;strong&gt;completeWork&lt;/strong&gt;&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°&lt;code class=&quot;language-text&quot;&gt;ClickCounter&lt;/code&gt;ä¸­çš„count state&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;æ–¹æ³•å»å¾—åˆ°childrenåˆ—è¡¨å¹¶æ‰§è¡Œæ¯”è¾ƒ&lt;/li&gt;
&lt;li&gt;æ›´æ–°&lt;code class=&quot;language-text&quot;&gt;span&lt;/code&gt;å…ƒç´ çš„props&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L523&quot;&gt;&lt;strong&gt;commitRoot&lt;/strong&gt;&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°&lt;code class=&quot;language-text&quot;&gt;span&lt;/code&gt;å…ƒç´ çš„&lt;code class=&quot;language-text&quot;&gt;textContent&lt;/code&gt;å±æ€§&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code class=&quot;language-text&quot;&gt;cDU&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;renderé˜¶æ®µ&lt;/h2&gt;
&lt;h3&gt;Scheduling updatesï¼ˆå®‰æ’æ›´æ–°ï¼‰&lt;/h3&gt;
&lt;p&gt;â€‹	å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œä¼šè§¦å‘ç‚¹å‡»äº‹ä»¶ç„¶åreactè§£ææˆ‘ä»¬ä¼ ç»™æŒ‰é’®propsçš„callbackã€‚åœ¨è¿™ä¸ªåº”ç”¨ä¸­callbackæ˜¯å¢åŠ counterå¹¶æ›´æ–°stateã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//...&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹		æ¯ä¸€ä¸ªReactç»„ä»¶éƒ½æœ‰ä¸€ä¸ª&lt;code class=&quot;language-text&quot;&gt;updater&lt;/code&gt;ä½œä¸ºç»„ä»¶å’Œreactæ ¸å¿ƒé€šä¿¡çš„æ¡¥æ¢ã€‚ä»–å…è®¸&lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt;åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼ˆReactDOMï¼ŒRNï¼Œ SSRï¼Œ testï¼‰å®ç°ä¸åŒçš„æ•ˆæœ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šå…³äºupdaterï¼Œå¯ä»¥å…³è”å­¦ä¹ danå¤§ç¥åšå®¢çš„&lt;a href=&quot;https://overreacted.io/how-does-setstate-know-what-to-do/&quot;&gt;How Does setState Know What to Do?&lt;/a&gt; &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€‹	åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šä¾§é‡ReactDomçš„ä½¿ç”¨äº†Fiber reconcilerçš„updaterå®ç°ï¼Œå¯¹äº&lt;code class=&quot;language-text&quot;&gt;ClickCounter&lt;/code&gt;ç»„ä»¶æ˜¯&lt;a href=&quot;https://github.com/facebook/react/blob/6938dcaacbffb901df27782b7821836961a5b68d/packages/react-reconciler/src/ReactFiberClassComponent.js#L186&quot;&gt;&lt;strong&gt;classComponentUpdater&lt;/strong&gt;&lt;/a&gt;ï¼Œä»–è´Ÿè´£æ£€ç´¢fiberå®ä¾‹ï¼Œé˜Ÿåˆ—æ›´æ–°å’Œå®‰æ’å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å½“æ›´æ–°æ’é˜Ÿæ—¶ï¼Œä»–ä»¬åŸºæœ¬ä¸Šåªæ˜¯è¢«æ·»åŠ åˆ°fiberèŠ‚ç‚¹ä¸Šå¤„ç†çš„æ›´æ–°é˜Ÿåˆ—ä¸­ã€‚åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­ï¼Œä¸ClickCounterç»„ä»¶å¯¹åº”çš„fiberèŠ‚ç‚¹æœ‰ä»¥ä¸‹çš„ç»“æ„&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClickCounter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    updateQueue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
         baseState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
         firstUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
             next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                 payload&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
             &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
         &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code class=&quot;language-text&quot;&gt;updateQueue.firstUpdate.next.payload&lt;/code&gt;ä¸­çš„å‡½æ•°æ˜¯æˆ‘ä»¬ä¼ ç»™&lt;code class=&quot;language-text&quot;&gt;ClickCounter&lt;/code&gt;ç»„ä»¶ä¸­setStateçš„callbackã€‚ä»–è¡¨ç¤ºåœ¨renderé˜¶æ®µéœ€è¦è¢«å¤„ç†çš„ç¬¬ä¸€ä¸ªæ›´æ–°ã€‚&lt;/p&gt;
&lt;h3&gt;å¤„ç†ClickCounter Fiberç»“ç‚¹çš„æ›´æ–°&lt;/h3&gt;
&lt;p&gt;â€‹	æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªClickCounterå®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥&lt;a href=&quot;https://github.com/facebook/react/blob/6938dcaacbffb901df27782b7821836961a5b68d/packages/react-reconciler/src/ReactFiberClassComponent.js#L976&quot;&gt;&lt;strong&gt;updateClassInstance&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ï¼Œè¿™é‡Œæ˜¯reactå¯¹classç»„ä»¶æ‰§è¡Œæœ€å¤šæ“ä½œçš„å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯æŒ‰æ‰§è¡Œé¡ºåºåœ¨å‡½æ•°ä¸­æ‰§è¡Œçš„æœ€é‡è¦çš„æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨&lt;strong&gt;UNSAFE_componentWillReceiveProps&lt;/strong&gt;é’©å­ï¼ˆåœ¨react v17ä¸­å¼ƒç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ&lt;strong&gt;updateQueue&lt;/strong&gt;ä¸­çš„æ›´æ–°å¹¶ç”Ÿæˆæ–°çš„state&lt;/li&gt;
&lt;li&gt;ç”¨æ–°çš„stateè°ƒç”¨&lt;strong&gt;getDerivedStateFromProps&lt;/strong&gt;å¹¶å¾—åˆ°ç»“æœ&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;strong&gt;sCU&lt;/strong&gt;ç¡®å®šä¸€ä¸ªç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦‚æœ&lt;strong&gt;false&lt;/strong&gt;ï¼Œè·³è¿‡æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;strong&gt;UNSAFE_componentWillUpdate&lt;/strong&gt;é’©å­ï¼ˆåœ¨react v17ä¸­å¼ƒç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;æ·»åŠ ä¸€ä¸ªeffectå»è§¦å‘&lt;strong&gt;componentDidUpdate&lt;/strong&gt;é’©å­&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;cDU&lt;/strong&gt;è¿™ä¸ªeffectåœ¨&lt;strong&gt;render&lt;/strong&gt;é˜¶æ®µä¸­è¢«æ·»åŠ ï¼Œä½†æ˜¯åœ¨&lt;strong&gt;commit&lt;/strong&gt;ä¸­æ‰§è¡Œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°ç»„ä»¶å®ä¾‹çš„&lt;strong&gt;state&lt;/strong&gt;å’Œ&lt;strong&gt;props&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‡½æ•°ç®€åŒ–åå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateClassInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stateNode&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; oldProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; oldProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;oldProps &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; newProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;callComponentWillReceiveProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; updateQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updateQueue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updateQueue &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;processUpdateQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateQueue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        newState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;applyDerivedStateFromProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    newState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; shouldUpdate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;checkShouldComponentUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;shouldUpdate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;componentWillUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; Update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; Snapshot&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; shouldUpdate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç ç‰‡æ®µç§»é™¤äº†ä¸€äº›è¾…åŠ©ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–æ·»åŠ effectæ¥è§¦å‘å®ƒä»¬æ—¶ï¼Œreactä¼šç”¨&lt;strong&gt;typeof&lt;/strong&gt;æ£€æŸ¥ä¸€ä¸ªç»„ä»¶æ˜¯å¦å®ç°äº†è¿™äº›æ–¹æ³•ã€‚ä¸‹é¢æ˜¯reactåœ¨æ·»åŠ effectå‰æ£€æŸ¥&lt;strong&gt;cDU&lt;/strong&gt;æ–¹æ³•&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;componentDidUpdate &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; Update&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“åœ¨renderé˜¶æ®µ&lt;strong&gt;ClickCounter&lt;/strong&gt;ä¼šæ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›æ“ä½œæ˜¯æ€ä¹ˆæ”¹å˜fiberèŠ‚ç‚¹çš„å€¼ã€‚å½“reactå¼€å§‹å·¥ä½œå‰ï¼Œ&lt;strong&gt;ClickCounter&lt;/strong&gt;çš„fiberèŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    elementType&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    firstEffect&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    memoizedState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    updateQueue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        baseState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        firstUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            next&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                payload&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;â€¦&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨å·¥ä½œå®Œæˆåï¼ŒfiberèŠ‚ç‚¹æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    elementType&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    firstEffect&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    memoizedState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClickCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    updateQueue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        baseState&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        firstUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨æ›´æ–°è¢«æ‰§è¡Œåï¼Œ&lt;strong&gt;count&lt;/strong&gt;çš„å€¼åœ¨&lt;strong&gt;memoized&lt;/strong&gt;å’Œ&lt;strong&gt;updateQueue&lt;/strong&gt;ä¸­çš„&lt;strong&gt;baseState&lt;/strong&gt;å˜æˆäº†&lt;strong&gt;1&lt;/strong&gt;ã€‚reactä¹Ÿæ›´æ–°äº†&lt;strong&gt;ClickCounter&lt;/strong&gt;ç»„ä»¶å®ä¾‹ä¸­çš„state(stateNode)ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­å·²ç»æ²¡æœ‰æ›´æ–°äº†ï¼Œæ‰€ä»¥&lt;strong&gt;firstUpdate&lt;/strong&gt;æ˜¯&lt;strong&gt;null&lt;/strong&gt;ã€‚è€Œä¸”&lt;strong&gt;effectTag&lt;/strong&gt;ä»0-&gt;4ï¼ŒäºŒè¿›åˆ¶ä¸­æ˜¯100ï¼Œå³ç¬¬ä¸‰ä½è®¾äº†1ï¼Œæ„ä¹‰æ˜¯Â &lt;a href=&quot;https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/packages/shared/ReactSideEffectTags.js&quot;&gt;side-effect tag&lt;/a&gt;ä¸­çš„&lt;strong&gt;Update&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Update &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b00000000100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ€»ç»“ï¼Œå½“åœ¨å¤„ç†ClickCounter fiberèŠ‚ç‚¹æ—¶ï¼Œreactè°ƒç”¨æ›´æ–°å‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ›´æ–°stateå’Œå®šä¹‰ç›¸åº”çš„side-effectsã€‚&lt;/p&gt;
&lt;h3&gt;Reconciling children for the ClickCounter Fiber&lt;/h3&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥ï¼Œreactå¼€å§‹Â &lt;a href=&quot;https://github.com/facebook/react/blob/340bfd9393e8173adca5380e6587e1ea1a23cefa/packages/react-reconciler/src/ReactFiberBeginWork.js#L355&quot;&gt;finishClassComponent&lt;/a&gt;ï¼Œåœ¨è¿™é‡Œreactä¼šè°ƒç”¨reactç»„ä»¶å®ä¾‹çš„&lt;strong&gt;render&lt;/strong&gt;æ–¹æ³•å¹¶åœ¨ç»„ä»¶è¿”å›çš„çš„å­©å­ä¸Šåº”ç”¨diffç®—æ³•ã€‚æ›´é«˜é˜¶çš„æ¦‚è¿°åœ¨è¿™ä¸ª&lt;a href=&quot;https://reactjs.org/docs/reconciliation.html#the-diffing-algorithm&quot;&gt;æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“æ¯”è¾ƒä¸¤ä¸ªç›¸åŒç±»å‹çš„React DOMå…ƒç´ æ—¶ï¼ŒReactæŸ¥çœ‹ä¸¤è€…çš„å±æ€§ï¼Œä¿æŒç›¸åŒçš„åº•å±‚DOMèŠ‚ç‚¹ï¼Œå¹¶ä»…æ›´æ–°æ›´æ”¹çš„å±æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æ·±å…¥æŒ–æ˜ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®é™…ä¸Šæ˜¯æ¯”è¾ƒreactå…ƒç´ çš„fiberèŠ‚ç‚¹ï¼Œä½†æˆ‘ç°åœ¨ä¸ä¼šè¯¦ç»†ä»‹ç»ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹éå¸¸ç²¾ç»†ã€‚æˆ‘ä¼šå†™ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« ï¼Œç‰¹åˆ«å…³æ³¨child reconciliationã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæ‚¨æ€¥äºè‡ªå·±å­¦ä¹ ç»†èŠ‚ï¼ŒæŸ¥çœ‹&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactChildFiber.js#L732&quot;&gt;reconcileChildrenArray&lt;/a&gt;å‡½æ•°å› ä¸ºæˆ‘ä»¬è¿™ä¸ªåº”ç”¨çš„renderæ–¹æ³•è¿”å›äº†ä¸€ä¸ªreactå…ƒç´ çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å½“reactæ‰§è¡Œchild reconciliationæ—¶ï¼Œä»–åˆ›å»ºæˆ–æ›´æ–°renderæ–¹æ³•è¿”å›çš„reacå…ƒç´ çš„fiberèŠ‚ç‚¹ã€‚&lt;strong&gt;finishClassComponent&lt;/strong&gt;å‡½æ•°è¿”å›å½“å‰fiberèŠ‚ç‚¹ç¬¬ä¸€ä¸ªå­©å­çš„å¼•ç”¨ã€‚å®ƒä¼šåˆ†é…åˆ°&lt;strong&gt;nextUnitOfWork&lt;/strong&gt;å¹¶åœ¨ç¨åçš„work loopä¸­å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;reactæ›´æ–°childrençš„propsä½œä¸ºparentå·¥ä½œçš„ä¸€éƒ¨åˆ†ã€‚ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨æ¥è‡ªrenderæ–¹æ³•è¿”å›çš„Reactå…ƒç´ çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯&lt;strong&gt;span&lt;/strong&gt;åœ¨react reconcileä¹‹å‰çš„fiberèŠ‚ç‚¹&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HTMLSpanElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   memoizedProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   pendingProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œ&lt;strong&gt;memoizedProps&lt;/strong&gt;å’Œ&lt;strong&gt;pendingProps&lt;/strong&gt;ä¸­çš„&lt;strong&gt;children&lt;/strong&gt;æ˜¯&lt;strong&gt;0&lt;/strong&gt;ï¼Œè¿™é‡Œæ˜¯spanå…ƒç´ è¢«renderåè¿”å›çš„reactå…ƒç´ &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   $$&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Symbol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;react&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2&quot;&lt;/span&gt;
   props&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   ref&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
   type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒfiberèŠ‚ç‚¹ä¸­çš„propså’Œè¢«è¿”å›çš„reactå…ƒç´ æœ‰ä¸åŒï¼Œåœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L326&quot;&gt;&lt;strong&gt;createWorkInProgress&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ä¸­åˆ›å»ºalternate fiberèŠ‚ç‚¹ï¼Œ&lt;strong&gt;reactä¼šä»reactå…ƒç´ ä¸­æœ‰æ›´æ–°çš„å±æ€§ä¸­å¤åˆ¶åˆ°fiberèŠ‚ç‚¹&lt;/strong&gt;ã€‚æ‰€ä»¥ï¼Œå½“reactç»“æŸ&lt;strong&gt;ClickCouter&lt;/strong&gt;ç»„ä»¶çš„child reconciliationï¼Œ&lt;strong&gt;span&lt;/strong&gt;çš„fiberèŠ‚ç‚¹ä¼šæ›´æ–°&lt;strong&gt;pendingProps&lt;/strong&gt;å±æ€§ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HTMLSpanElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   memoizedProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   pendingProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“reactæ‰§è¡Œspan fiberèŠ‚ç‚¹å·¥ä½œæ—¶ï¼Œä¼šå°†pendingPropså¤åˆ¶åˆ°&lt;strong&gt;memoizedProps&lt;/strong&gt;ä¸­å¹¶æ·»åŠ ä¸€ä¸ªeffectså»æ›´æ–°DOMã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;   è¿™å°±æ˜¯renderé˜¶æ®µreactåœ¨&lt;strong&gt;ClickCounter&lt;/strong&gt; fiberèŠ‚ç‚¹ä¸Šçš„å·¥ä½œã€‚å› ä¸ºbuttonæ˜¯ClickCounterç»„ä»¶çš„ç¬¬ä¸€ä¸ªå­©å­ï¼Œä»–ä¼šè¢«åˆ†é…åˆ°&lt;strong&gt;nextUnitOfWork&lt;/strong&gt;ï¼Œä¸”ä»–æ²¡ä»€ä¹ˆåµäº‹è¦å¹²ï¼Œæ‰€ä»¥reactä¼šç§»åŠ¨åˆ°ä»–çš„å…„å¼ŸèŠ‚ç‚¹â€”spanã€‚&lt;/p&gt;
&lt;h3&gt;Processing updates for the Span fiber&lt;/h3&gt;
&lt;p&gt;ä¸&lt;strong&gt;ClickCounter&lt;/strong&gt;ç›¸ä¼¼ï¼Œä»&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js#L1489&quot;&gt;beginWork&lt;/a&gt;å‡½æ•°å¼€å§‹ã€‚å› ä¸º&lt;strong&gt;span&lt;/strong&gt;èŠ‚ç‚¹æ˜¯&lt;strong&gt;HostComponent&lt;/strong&gt;ç±»å‹ï¼Œæ‰€ä»¥ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current$$&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; FunctionalComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; ClassComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; HostComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateHostComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js#L686&quot;&gt;updateHostComponent&lt;/a&gt;ç»“æŸã€‚å¯ä»¥ä¸classç»„ä»¶è°ƒç”¨çš„&lt;strong&gt;updateClassComponent&lt;/strong&gt;å¯¹æ¯”ã€‚å¯¹äºå‡½æ•°å¼ç»„ä»¶æ˜¯&lt;strong&gt;updateFunctionComponent&lt;/strong&gt;ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/1034e26fe5e42ba07492a736da7bdf5bf2108bc6/packages/react-reconciler/src/ReactFiberBeginWork.js&quot;&gt;&lt;strong&gt;ReactFiberBeginWork.js&lt;/strong&gt;&lt;/a&gt;ä¸­æ‰¾åˆ°æ‰€æœ‰è¿™äº›å‡½æ•°ã€‚&lt;/p&gt;
&lt;h3&gt;Reconciling children for the span fiber&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒspanèŠ‚ç‚¹çš„&lt;strong&gt;updateHostComponent&lt;/strong&gt;ä¸­æ²¡æœ‰ç‰¹åˆ«é‡è¦çš„äº‹æƒ…å‘ç”Ÿã€‚&lt;/p&gt;
&lt;h3&gt;Completing work for the Span Fiber node&lt;/h3&gt;
&lt;p&gt;å½“&lt;strong&gt;beginWork&lt;/strong&gt;ç»“æŸåï¼Œä¼šè¿›å…¥&lt;strong&gt;completeWork&lt;/strong&gt;ã€‚ä¸è¿‡åœ¨è¿™ä¹‹å‰ï¼Œreactéœ€è¦æ›´æ–°span fiberèŠ‚ç‚¹ä¸Šçš„&lt;strong&gt;memoizedProps&lt;/strong&gt;ï¼Œä½ å¯èƒ½è¿˜è®°å¾—å½“&lt;strong&gt;ClickCounter&lt;/strong&gt;ä¸Šreconciling childrenæ—¶ï¼Œreactæ›´æ–°äº†span fiberèŠ‚ç‚¹çš„&lt;strong&gt;pendingProps&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//è¿™æ˜¯ä¹‹å‰çš„&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HTMLSpanElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    memoizedProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    pendingProps&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“&lt;strong&gt;span&lt;/strong&gt;çš„fiber&lt;strong&gt;beginWork&lt;/strong&gt;å®Œæˆåï¼Œreactæ›´æ–°pendingPropsä»¥åŒ¹é…memoizedProps&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;performUnitOfWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beginWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current$$&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextRenderExpirationTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoizedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pendingProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åå®ƒè°ƒç”¨completeWorkå‡½æ•°ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç±»ä¼¼äºæˆ‘ä»¬åœ¨beginWorkä¸­çœ‹åˆ°çš„å¤§è½¬æ¢è¯­å¥&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;completeWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;workInProgress&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; FunctionComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; ClassComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; HostComponent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;updateHostComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workInProgress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬çš„span FiberèŠ‚ç‚¹æ˜¯HostComponentï¼Œå› æ­¤å®ƒè¿è¡Œ&lt;a href=&quot;https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js#L686&quot;&gt;&lt;strong&gt;updateHostComponent&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒReactåŸºæœ¬ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡†å¤‡DOMæ›´æ–°&lt;/li&gt;
&lt;li&gt;å°†è¿™äº›æ›´æ–°æ”¾åˆ°span fiberèŠ‚ç‚¹çš„updateQueue&lt;/li&gt;
&lt;li&gt;å°†è¿™äº›effectåº”ç”¨åˆ°æ›´æ–°DOMä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æ‰§è¡Œè¿™äº›æ“ä½œä¹‹å‰ï¼Œspan FiberèŠ‚ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HTMLSpanElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    updateQueue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“å·¥ä½œå®Œæˆæ—¶ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    stateNode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HTMLSpanElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;span&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    updateQueue&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;children&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	æ³¨æ„effectTagå’ŒupdateQueueå­—æ®µçš„åŒºåˆ«ã€‚å®ƒä¸å†æ˜¯0ï¼Œå®ƒçš„å€¼æ˜¯4.åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œè¿™æ˜¯100ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸‰ä½è¢«è®¾ç½®ï¼Œè¿™æ˜¯&lt;strong&gt;update&lt;/strong&gt; side-effectçš„æ ‡å¿—ä½ã€‚è¿™æ˜¯reactéœ€è¦åœ¨æ¥ä¸‹æ¥çš„commité˜¶æ®µå¯¹è¿™ä¸ªèŠ‚ç‚¹ä»…éœ€çš„å·¥ä½œã€‚&lt;strong&gt;updateQueue&lt;/strong&gt;å­—æ®µä¿å­˜å°†ç”¨äºæ›´æ–°çš„æœ‰æ•ˆpayloadã€‚ &lt;/p&gt;
&lt;p&gt;â€‹	å½“reactå¤„ç†å®Œ&lt;strong&gt;ClickCounter&lt;/strong&gt;å’Œä»–çš„å­©å­ï¼Œrenderé˜¶æ®µå°±ç»“æŸäº†ã€‚å®ƒç°åœ¨å¯ä»¥å°†å®Œæˆçš„alternate treeåˆ†é…ç»™FiberRootä¸Šçš„finishedWorkå±æ€§ã€‚è¿™æ˜¯éœ€è¦åˆ·æ–°åˆ°å±å¹•çš„æ–°æ ‘ã€‚å®ƒå¯ä»¥åœ¨æ¸²æŸ“é˜¶æ®µåç«‹å³å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ç»™å‡ºReactæ—¶é—´åå†å¤„ç†ã€‚&lt;/p&gt;
&lt;h3&gt;Effects list&lt;/h3&gt;
&lt;p&gt;â€‹	åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºspanèŠ‚ç‚¹å’ŒClickCounterç»„ä»¶æœ‰side effectsï¼Œreactä¼šå°†spançš„fiberèŠ‚ç‚¹è¿æ¥åˆ°HostFiberçš„firstEffectå±æ€§ã€‚reactä¼šåœ¨&lt;a href=&quot;https://github.com/facebook/react/blob/d5e1bf07d086e4fc1998653331adecddcd0f5274/packages/react-reconciler/src/ReactFiberScheduler.js#L999&quot;&gt;&lt;strong&gt;compliteUnitOfWork&lt;/strong&gt;&lt;/a&gt;å‡½æ•°æ„å»ºeffects listï¼Œä»¥ä¸‹æ˜¯å…·æœ‰æ›´æ–°spanèŠ‚ç‚¹å’ŒClickCounterä¸Šçš„é’©å­æ•ˆæœçš„fiber treeï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pjpqjxkf6.bkt.clouddn.com/1_TRmFSeuOuWlY3HXh86cvDA.png&quot;&gt;&lt;/p&gt;
&lt;h2&gt;commité˜¶æ®µ&lt;/h2&gt;
&lt;p&gt;â€‹	commité˜¶æ®µæ˜¯reactæ›´æ–°DOMå’Œè°ƒç”¨cDUç”Ÿå‘½å‘¨æœŸã€‚ä¸ºäº†å®ç°ï¼Œreactä¼šéå†renderé˜¶æ®µæ„å»ºçš„effects listå¹¶åº”ç”¨ä»–ä»¬ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClickCounter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;span&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; effectTag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	ClickCouterçš„effect tagæ˜¯5ï¼ˆäºŒè¿›åˆ¶æ˜¯101ï¼‰ï¼Œå®šä¹‰äº†&lt;strong&gt;Update&lt;/strong&gt;ï¼Œå¯¹äºclassç»„ä»¶æ¥è¯´åŸºæœ¬ä¸Šæ˜¯è½¬æ¢&lt;strong&gt;componentDidUpdate&lt;/strong&gt;ï¼ŒäºŒè¿›åˆ¶çš„æœ€åä¸€ä½è¢«è®¾ç½®æ„å‘³ç€è¿™ä¸ªfiberèŠ‚ç‚¹åœ¨&lt;strong&gt;render&lt;/strong&gt;é˜¶æ®µçš„æ‰€æœ‰å·¥ä½œå·²ç»å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;â€‹	spançš„effect tagæ˜¯4ï¼ˆäºŒè¿›åˆ¶100ï¼‰ï¼Œå®šä¹‰äº† updateï¼Œå¯¹äºhostç»„ä»¶æ¥è¯´æ˜¯DOMæ›´æ–°ã€‚åœ¨spanå…ƒç´ çš„æƒ…å†µä¸‹ï¼Œreactä¼šæ›´æ–°å…ƒç´ çš„&lt;strong&gt;textContent&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;Applying effects&lt;/h3&gt;
&lt;p&gt;â€‹	è®©æˆ‘ä»¬çœ‹çœ‹reactæ˜¯å¦‚ä½•åº”ç”¨è¿™äº›effectsçš„ï¼Œ&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L523&quot;&gt;&lt;strong&gt;commitRoot&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ï¼ŒåŒ…å«äº†ä¸‰ä¸ªå­å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;commitRoot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; finishedWork&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitBeforeMutationLifecycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitAllHostEffects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; finishedWork&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;commitAllLifeCycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 	æ¯ä¸€ä¸ªå­å‡½æ•°éƒ½ä¼šéå†effecys listå¹¶æ£€æŸ¥effectsçš„ç±»å‹ã€‚å½“å®ƒæ‰¾åˆ°ä¸å‡½æ•°ç›®çš„ç›¸å…³çš„æ•ˆæœæ—¶ï¼Œå®ƒä¼šåº”ç”¨å®ƒã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒcommitRootä¼šè°ƒç”¨&lt;strong&gt;ClickCounter&lt;/strong&gt;çš„&lt;strong&gt;cDU&lt;/strong&gt;å’Œæ›´æ–°&lt;strong&gt;span&lt;/strong&gt;å…ƒç´ çš„æ–‡æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ç¬¬ä¸€ä¸ªå‡½æ•°&lt;a href=&quot;https://github.com/facebook/react/blob/fefa1269e2a67fa5ef0992d5cc1d6114b7948b7e/packages/react-reconciler/src/ReactFiberCommitWork.js#L183&quot;&gt;commitBeforeMutationLifeCycles&lt;/a&gt;ä¼šæŸ¥æ‰¾&lt;a href=&quot;https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/packages/shared/ReactSideEffectTags.js#L25&quot;&gt;&lt;strong&gt;Snapshot&lt;/strong&gt;&lt;/a&gt; effectå¹¶è°ƒç”¨&lt;strong&gt;getSnapshotBeforeUpdate&lt;/strong&gt;æ–¹æ³•ã€‚ä¸è¿‡æˆ‘ä»¬çš„&lt;strong&gt;ClickCouter&lt;/strong&gt;ç»„ä»¶æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œreactä¸ä¼šåœ¨&lt;strong&gt;render&lt;/strong&gt;é˜¶æ®µä¸­æ·»åŠ è¿™ä¸ªeffectï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªå‡½æ•°ä¸èµ·ä½œç”¨ã€‚&lt;/p&gt;
&lt;h3&gt;DOM updates&lt;/h3&gt;
&lt;p&gt;â€‹	ä¸‹ä¸€æ­¥ï¼Œreactä¼šæ‰§è¡Œ&lt;a href=&quot;https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js#L376&quot;&gt;&lt;strong&gt;commitAllHostEffects&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­Reactä¼šå°†&lt;strong&gt;span&lt;/strong&gt;å…ƒç´ çš„æ–‡æœ¬ä»0æ”¹å˜åˆ°1ï¼Œè€ŒClickCounterç»„ä»¶åˆ™ä¸å—ä»»ä½•å½±å“å› ä¸ºclassç»„ä»¶å¯¹åº”çš„èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•DOMæ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	è¯¥å‡½æ•°çš„è¦ç‚¹æ˜¯å®ƒé€‰æ‹©æ­£ç¡®çš„æ•ˆæœç±»å‹å¹¶åº”ç”¨ç›¸åº”çš„æ“ä½œã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°spanå…ƒç´ çš„æ–‡æœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œé‡‡ç”¨&lt;strong&gt;Update&lt;/strong&gt;åˆ†æ”¯ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateHostEffects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;primaryEffectTag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Placement&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; PlacementAndUpdate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Update&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alternate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;commitWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Deletion&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	ç»§ç»­æ‰§è¡Œ&lt;strong&gt;commitWork&lt;/strong&gt;ï¼Œreactä¼šæ‰§è¡Œ&lt;a href=&quot;https://github.com/facebook/react/blob/8a8d973d3cc5623676a84f87af66ef9259c3937c/packages/react-dom/src/client/ReactDOMComponent.js#L326&quot;&gt;&lt;strong&gt;updateDOMProperties&lt;/strong&gt;&lt;/a&gt;å‡½æ•°ï¼Œä»–å°†åœ¨renderé˜¶æ®µæ·»åŠ çš„updateQueueåº”ç”¨åˆ°fiberèŠ‚ç‚¹ä¸Šï¼Œå¹¶æ›´æ–°&lt;strong&gt;span&lt;/strong&gt;å…ƒç´ çš„&lt;strong&gt;textContent&lt;/strong&gt;å±æ€§ã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateDOMProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;domElement&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updatePayload&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; updatePayload&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; updatePayload&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; updatePayload&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propKey &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;STYLE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propKey &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;DANGEROUSLY_SET_INNER_HTML&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propKey &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CHILDREN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;setTextContent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;domElement&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; propValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	å½“DOMæ›´æ–°è¢«æ‰§è¡Œåï¼Œreactå°†&lt;strong&gt;finishedWork&lt;/strong&gt;æ ‘åˆ†é…åˆ°&lt;strong&gt;HostRoot&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; finishedWork&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Calling post mutation lifecycle hooks&lt;/h3&gt;
&lt;p&gt;â€‹	å‰©ä¸‹çš„æœ€åä¸€ä¸ªå‡½æ•°æ˜¯&lt;a href=&quot;https://github.com/facebook/react/blob/d5e1bf07d086e4fc1998653331adecddcd0f5274/packages/react-reconciler/src/ReactFiberScheduler.js#L479&quot;&gt;&lt;strong&gt;commitAllLifecycles&lt;/strong&gt;&lt;/a&gt;ã€‚åœ¨è¿™é‡Œreactä¼šè°ƒç”¨æ›´æ–°åçš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨renderé˜¶æ®µä¸­ï¼Œreactæ·»åŠ &lt;strong&gt;Update&lt;/strong&gt; effectåˆ°&lt;strong&gt;ClickCounter&lt;/strong&gt;ç»„ä»¶ä¸­ã€‚è¿™æ˜¯&lt;strong&gt;commitAllLifecycles&lt;/strong&gt;æŸ¥æ‰¾å¹¶è°ƒç”¨çš„å…¶ä¸­ä¸€ä¸ªå‘¨æœŸã€‚&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;commitAllLifeCycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;finishedRoot&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; effectTag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;effectTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Update &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alternate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitLifeCycles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;finishedRoot&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;effectTag &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Ref&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;commitAttachRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        
        nextEffect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextEffect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nextEffect&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â€‹	åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œreactä¹Ÿä¼šè°ƒç”¨ç¬¬ä¸€æ¬¡è¢«æ¸²æŸ“çš„ç»„ä»¶çš„&lt;strong&gt;cDM&lt;/strong&gt;&lt;/p&gt;</content:encoded></item></channel></rss>