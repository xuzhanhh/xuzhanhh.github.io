---
title: 使用位操作快速实现互斥选项
date: '2019-03-20'
spoiler: 位操作入门篇
---

## 前言

​	产品需求选择器实现如下效果，即某一行选中了某一个数值后那么其余行该选项就不可以选中了，这种就是很明显的标志位操作了，一般用字符串，对象什么的也可以解决。就是选中时在字符串中加入该value，然后在遍历渲染<Option>时用正则match一下判断是否该渲染即可。

![image-20190320202815576](./images/image-20190320202815576.png)

## 位操作逻辑

 以下逻辑仅为本人**快速实现业务逻辑**，没怎么经过拓展和优化代码的。如果有更好的实现方案欢迎大佬指导！

### 定义tag

在每一个选项多一个tag项，其值为二进制全部0并只有一位为1的number，且唯一。currentSelect作为记录当前的tag总和

```javascript
const pointMap = {
  APP: {
    name: 'APP',
    value: 'APP',
    tag: 0b0001
  },
  M: {
    name: 'M',
    value: 'M',
    tag: 0b0010
  },
  WQ: {
    name: 'WQ',
    value: 'WQ',
    tag: 0b0100
  },
  MINI: {
    name: '小程序',
    value: 'MINI',
    tag: 0b1000
  },
}
```

### 添加/修改选项

当前tag ^ 被取消选择的tag(如果有的话) | 当前选中的tag 

```javascript
currentData.currentSelect ^ pointMap[(oldItemChannel ? oldItemChannel : item.channel)].tag | tag
```

### 取消选择/删除行

当前tag ^ 被取消选择的tag

```javascript
currentData.currentSelect ^ pointMap[(item.channel)].tag
```

### 简单解析

**1. 删除**

假定有三行，且当前选择了APP，M，WQ 那么currentSelect是0b0111，如果删除WQ行则运算为：

​	0b0111 ^ 0b0100 = 0b011

相同的位置0，不同的位置1

**2. 添加**

这个太简单了，就是有1的位就置1