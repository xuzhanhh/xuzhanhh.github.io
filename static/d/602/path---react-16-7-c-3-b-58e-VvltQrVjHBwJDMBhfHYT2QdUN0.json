{"data":{"site":{"siteMetadata":{"title":"酱香型猫砂盆","author":"xuzhanhh"}},"markdownRemark":{"id":"5d6aff10-a2ce-5c90-87e2-9613addfdbf8","html":"<h1>react 16.7</h1>\n<h2>React DOM</h2>\n<h3>1. Fix performance of <code class=\"language-text\">React.lazy</code> for large numbers of lazily-loaded components. (<a href=\"https://github.com/acdlite\">@acdlite</a> in <a href=\"https://github.com/facebook/react/pull/14429\">#14429</a>)</h3>\n<h3>2. Clear fields on unmount to avoid memory leaks. (<a href=\"https://github.com/trueadm\">@trueadm</a> in <a href=\"https://github.com/facebook/react/pull/14276\">#14276</a>)</h3>\n<h3>3. Fix bug with SSR and context when mixing <code class=\"language-text\">react-dom/server@16.6</code> and <code class=\"language-text\">react@&lt;16.6</code>. (<a href=\"https://github.com/gaearon\">@gaearon</a> in <a href=\"https://github.com/facebook/react/pull/14291\">#14291</a>)</h3>\n<h3>4. Fix a performance regression in profiling mode. (<a href=\"https://github.com/bvaughn\">@bvaughn</a> in <a href=\"https://github.com/facebook/react/pull/14383\">#14383</a>)</h3>\n<h2>Scheduler</h2>\n<h3>1. Post to MessageChannel instead of window. (<a href=\"https://github.com/acdlite\">@acdlite</a> in <a href=\"https://github.com/facebook/react/pull/14234\">#14234</a>)</h3>\n<p>​\tScheduler需要在paint之后触发一个task（会用window去postMessage），在队列为空之前每一帧都会发生都会触发。这会导致其他message event handler每一帧都会被调用，即使它们立即退出，这也会增加每帧的显着开销。所以改用MessageChannel</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> MessageChannel <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Use a MessageChannel, if support exists</span>\n    <span class=\"token keyword\">var</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    channel<span class=\"token punctuation\">.</span>port1<span class=\"token punctuation\">.</span>onmessage <span class=\"token operator\">=</span> idleTick<span class=\"token punctuation\">;</span>\n    port <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">.</span>port2<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> </code></pre></div>\n<h3>2. Reduce serialization overhead. (<a href=\"https://github.com/developit\">@developit</a> in <a href=\"https://github.com/facebook/react/pull/14249\">#14249</a>)</h3>\n<p>在切换到MessageChannel的过程中，还是传递了”*”。 这实际上最终会触发序列化。 为了节省一些性能，改用undefined，因为传递一个像0这样的数字仍然会产生序列化开销 </p>\n<p>具体可以看<em><a href=\"https://cs.chromium.org/chromium/src/third_party/blink/renderer/bindings/core/v8/script_value.h?type=cs&#x26;g=0&#x26;l=74\">https://cs.chromium.org/chromium/src/third<em>party/blink/renderer/bindings/core/v8/script</em>value.h?type=cs&#x26;g=0&#x26;l=74</a></em> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    -  port.postMessage(&#39;*&#39;);\n    +  port.postMessage(undefined);</code></pre></div>\n<h3>3. Fix fallback to <code class=\"language-text\">setTimeout</code> in testing environments. (<a href=\"https://github.com/bvaughn\">@bvaughn</a> in <a href=\"https://github.com/facebook/react/pull/14358\">#14358</a>)</h3>\n<h3>4. Add methods for debugging. (<a href=\"https://github.com/mrkev\">@mrkev</a> in <a href=\"https://github.com/facebook/react/pull/14053\">#14053</a>)</h3>","timeToRead":2,"frontmatter":{"title":"react 16.7","date":"December 20, 2018","spoiler":"是的，hooks还没来"},"fields":{"slug":"/react 16.7/"}}},"pageContext":{"slug":"/react 16.7/","previous":{"fields":{"slug":"/react hooks@seb/"},"frontmatter":{"title":"react hooks@seb"}},"next":{"fields":{"slug":"/Inside Fiber/"},"frontmatter":{"title":"Inside Fiber"}}}}